

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Parcial Final ML &#8212; Parcial Final ML</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks_guardado_2';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Parcial Final ML
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Parcial.html">Parcial Final ML</a></li>



</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks_guardado_2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/notebooks_guardado_2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Parcial Final ML</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Parcial Final ML</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#presentado-por-angel-pineda">Presentado por: Angel Pineda</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fraud-detection">Fraud Detection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lectura-de-dataset">Lectura de dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reduccion-de-dimensionalidad">Reduccion de dimensionalidad</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#eliminacion-de-columnas-numericas-altamente-correlacionadas">Eliminación de columnas numericas altamente correlacionadas.</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-dataset-reducido">Analisis de dataset reducido</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda-fraude-con-datos-reducidos">EDA FRAUDE CON DATOS REDUCIDOS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wind-speed">Wind Speed</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-bivariado">Analisis bivariado</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion">Modelo de Clasificacion</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nn">K-NN</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matriz-de-confusion-curva-roc">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logisticregression">LogisticRegression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-bayes">Naive Bayes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost">XGBoost</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svm">SVM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlp">MLP</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-del-modelo-de-clasificacion">Resultados del Modelo de clasificación</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-regresion">Modelo de regresion</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas">Metricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">K-NN</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge">Ridge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso">Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">XGBoost</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">MLP</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="parcial-final-ml">
<h1>Parcial Final ML<a class="headerlink" href="#parcial-final-ml" title="Permalink to this heading">#</a></h1>
<section id="presentado-por-angel-pineda">
<h2>Presentado por: Angel Pineda<a class="headerlink" href="#presentado-por-angel-pineda" title="Permalink to this heading">#</a></h2>
</section>
</section>
<section id="eda">
<h1>EDA<a class="headerlink" href="#eda" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>Se importan algunas librerias necesarias para el EDA.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>
</pre></div>
</div>
</div>
</div>
<section id="fraud-detection">
<h2>Fraud Detection<a class="headerlink" href="#fraud-detection" title="Permalink to this heading">#</a></h2>
<section id="lectura-de-dataset">
<h3>Lectura de dataset<a class="headerlink" href="#lectura-de-dataset" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_transaction</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;train_transaction_new.csv&#39;</span><span class="p">)</span>
<span class="n">data_identity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;train_identity_new.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se reduce el tamaño de los dataframes para optimizar el computo.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reduce_mem_usage</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>

    <span class="n">start_mem</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">start_mem_GB</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Initial memory usage of dataframe is </span><span class="si">{</span><span class="n">start_mem</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> MB/</span><span class="si">{</span><span class="n">start_mem_GB</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> GB&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">col_type</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
        
        <span class="k">if</span> <span class="n">col_type</span> <span class="o">!=</span> <span class="nb">object</span><span class="p">:</span>
            <span class="n">c_min</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">c_max</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col_type</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

    <span class="n">end_mem</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">end_mem_GB</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
    <span class="n">reduction</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">start_mem</span> <span class="o">-</span> <span class="n">end_mem</span><span class="p">)</span> <span class="o">/</span> <span class="n">start_mem</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Memory usage after optimization is: </span><span class="si">{</span><span class="n">end_mem</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> MB/</span><span class="si">{</span><span class="n">end_mem_GB</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> GB&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Decreased by </span><span class="si">{</span><span class="n">reduction</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_transaction</span> <span class="o">=</span>  <span class="n">reduce_mem_usage</span><span class="p">(</span><span class="n">data_transaction</span><span class="p">)</span>
<span class="n">data_identity</span> <span class="o">=</span> <span class="n">reduce_mem_usage</span><span class="p">(</span><span class="n">data_identity</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial memory usage of dataframe is 351.69 MB/0.34 GB
Memory usage after optimization is: 78.50 MB/0.08 GB
Decreased by 77.7%
Initial memory usage of dataframe is 109.83 MB/0.11 GB
Memory usage after optimization is: 6.94 MB/0.01 GB
Decreased by 93.7%
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_transaction</span><span class="p">,</span> <span class="n">data_identity</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;TransactionID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se elimina los dataframes para liberar espacio en memoria</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">data_transaction</span>
<span class="k">del</span> <span class="n">data_identity</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se muestra los primeros 5 valores del dataset, se observa que hay columnas categoricas y numericas, donde la variable a predecir es “isFraud”</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TransactionID</th>
      <th>isFraud</th>
      <th>TransactionDT</th>
      <th>TransactionAmt</th>
      <th>ProductCD</th>
      <th>card1</th>
      <th>card2</th>
      <th>card3</th>
      <th>card4</th>
      <th>card5</th>
      <th>...</th>
      <th>id_31</th>
      <th>id_32</th>
      <th>id_33</th>
      <th>id_34</th>
      <th>id_35</th>
      <th>id_36</th>
      <th>id_37</th>
      <th>id_38</th>
      <th>DeviceType</th>
      <th>DeviceInfo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2987000</td>
      <td>0</td>
      <td>86400</td>
      <td>68.5</td>
      <td>W</td>
      <td>13926</td>
      <td>NaN</td>
      <td>150.0</td>
      <td>discover</td>
      <td>142.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2987001</td>
      <td>0</td>
      <td>86401</td>
      <td>29.0</td>
      <td>W</td>
      <td>2755</td>
      <td>404.0</td>
      <td>150.0</td>
      <td>mastercard</td>
      <td>102.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2987002</td>
      <td>0</td>
      <td>86469</td>
      <td>59.0</td>
      <td>W</td>
      <td>4663</td>
      <td>490.0</td>
      <td>150.0</td>
      <td>visa</td>
      <td>166.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2987003</td>
      <td>0</td>
      <td>86499</td>
      <td>50.0</td>
      <td>W</td>
      <td>18132</td>
      <td>567.0</td>
      <td>150.0</td>
      <td>mastercard</td>
      <td>117.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2987004</td>
      <td>0</td>
      <td>86506</td>
      <td>50.0</td>
      <td>H</td>
      <td>4497</td>
      <td>514.0</td>
      <td>150.0</td>
      <td>mastercard</td>
      <td>102.0</td>
      <td>...</td>
      <td>samsung browser 6.2</td>
      <td>32.0</td>
      <td>2220x1080</td>
      <td>match_status:2</td>
      <td>T</td>
      <td>F</td>
      <td>T</td>
      <td>T</td>
      <td>mobile</td>
      <td>SAMSUNG SM-G892A Build/NRD90M</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 434 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 99999 entries, 0 to 99998
Columns: 434 entries, TransactionID to DeviceInfo
dtypes: category(31), float16(375), float32(24), int16(1), int32(2), int8(1)
memory usage: 84.9 MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TransactionID</th>
      <th>isFraud</th>
      <th>TransactionDT</th>
      <th>TransactionAmt</th>
      <th>card1</th>
      <th>card2</th>
      <th>card3</th>
      <th>card5</th>
      <th>addr1</th>
      <th>addr2</th>
      <th>...</th>
      <th>id_17</th>
      <th>id_18</th>
      <th>id_19</th>
      <th>id_20</th>
      <th>id_21</th>
      <th>id_22</th>
      <th>id_24</th>
      <th>id_25</th>
      <th>id_26</th>
      <th>id_32</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>9.999900e+04</td>
      <td>99999.00000</td>
      <td>9.999900e+04</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>98645.0</td>
      <td>99996.0</td>
      <td>99474.0</td>
      <td>90962.0</td>
      <td>90962.0</td>
      <td>...</td>
      <td>39880.00000</td>
      <td>1.298100e+04</td>
      <td>39871.0</td>
      <td>39866.0</td>
      <td>1620.0</td>
      <td>1624.000000</td>
      <td>1500.000000</td>
      <td>1612.0000</td>
      <td>1623.0000</td>
      <td>2.983800e+04</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3.036999e+06</td>
      <td>0.02561</td>
      <td>1.135115e+06</td>
      <td>NaN</td>
      <td>9878.453325</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>inf</td>
      <td>inf</td>
      <td>inf</td>
      <td>inf</td>
      <td>inf</td>
      <td>15.515625</td>
      <td>13.226562</td>
      <td>inf</td>
      <td>inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.886737e+04</td>
      <td>0.15797</td>
      <td>5.733446e+05</td>
      <td>NaN</td>
      <td>4933.557719</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>...</td>
      <td>25.65625</td>
      <td>1.479492e+00</td>
      <td>inf</td>
      <td>inf</td>
      <td>inf</td>
      <td>6.054688</td>
      <td>2.179688</td>
      <td>104.0625</td>
      <td>31.0625</td>
      <td>3.654297e+00</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.987000e+06</td>
      <td>0.00000</td>
      <td>8.640000e+04</td>
      <td>0.291992</td>
      <td>1001.000000</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>13.0</td>
      <td>...</td>
      <td>100.00000</td>
      <td>1.100000e+01</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>12.000000</td>
      <td>11.000000</td>
      <td>100.0000</td>
      <td>100.0000</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.012000e+06</td>
      <td>0.00000</td>
      <td>6.537475e+05</td>
      <td>45.000000</td>
      <td>6019.000000</td>
      <td>215.0</td>
      <td>150.0</td>
      <td>166.0</td>
      <td>204.0</td>
      <td>87.0</td>
      <td>...</td>
      <td>166.00000</td>
      <td>1.300000e+01</td>
      <td>266.0</td>
      <td>222.0</td>
      <td>252.0</td>
      <td>14.000000</td>
      <td>11.000000</td>
      <td>272.0000</td>
      <td>121.0000</td>
      <td>2.400000e+01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>3.036999e+06</td>
      <td>0.00000</td>
      <td>1.189336e+06</td>
      <td>75.000000</td>
      <td>9653.000000</td>
      <td>387.0</td>
      <td>150.0</td>
      <td>226.0</td>
      <td>299.0</td>
      <td>87.0</td>
      <td>...</td>
      <td>166.00000</td>
      <td>1.300000e+01</td>
      <td>352.0</td>
      <td>391.0</td>
      <td>252.0</td>
      <td>14.000000</td>
      <td>15.000000</td>
      <td>321.0000</td>
      <td>150.0000</td>
      <td>2.400000e+01</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.061998e+06</td>
      <td>0.00000</td>
      <td>1.643436e+06</td>
      <td>136.000000</td>
      <td>14290.000000</td>
      <td>514.0</td>
      <td>150.0</td>
      <td>226.0</td>
      <td>330.0</td>
      <td>87.0</td>
      <td>...</td>
      <td>166.00000</td>
      <td>1.500000e+01</td>
      <td>492.0</td>
      <td>521.0</td>
      <td>576.0</td>
      <td>14.000000</td>
      <td>15.000000</td>
      <td>381.0000</td>
      <td>169.0000</td>
      <td>3.200000e+01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3.086998e+06</td>
      <td>1.00000</td>
      <td>2.006177e+06</td>
      <td>4828.000000</td>
      <td>18395.000000</td>
      <td>600.0</td>
      <td>229.0</td>
      <td>237.0</td>
      <td>540.0</td>
      <td>102.0</td>
      <td>...</td>
      <td>229.00000</td>
      <td>2.900000e+01</td>
      <td>671.0</td>
      <td>660.0</td>
      <td>853.0</td>
      <td>41.000000</td>
      <td>25.000000</td>
      <td>548.0000</td>
      <td>216.0000</td>
      <td>3.200000e+01</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 403 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Se encuentra una gran cantidad de datos faltantes, especialmente en DeviceType y DeviceInfo, se realizara una eliminación de columnas con muchos datos faltantes y luego sera necesario realizar un metodo de imputación de datos faltantes.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Calcular la cantidad de valores nulos en porcentaje para cada columna</span>
<span class="n">porcentaje_nulos</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_fraud</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_fraud</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># &#39;porcentaje_nulos&#39; ahora contiene el porcentaje de valores nulos para cada columna</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Porcentaje de valores nulos&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">porcentaje_nulos</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Numero de datos faltantes&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_fraud</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Porcentaje de valores nulos
TransactionID      0.000000
isFraud            0.000000
TransactionDT      0.000000
TransactionAmt     0.000000
ProductCD          0.000000
                    ...    
id_36             59.598596
id_37             59.598596
id_38             59.598596
DeviceType        59.716597
DeviceInfo        63.534635
Length: 434, dtype: float64

Numero de datos faltantes
TransactionID         0
isFraud               0
TransactionDT         0
TransactionAmt        0
ProductCD             0
                  ...  
id_36             59598
id_37             59598
id_38             59598
DeviceType        59716
DeviceInfo        63534
Length: 434, dtype: int64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Eliminación de Columnas con mas del 30% de datos faltantes, por motivos computacionales y por que no seria adecuado imputar datos a columnas que tienen mas del 30% de datos faltantes, no seria una muestra representativa para encontrar la mediana y moda.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Establecer un umbral del 50% para eliminar columnas</span>
<span class="n">umbral</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># Obtener una lista de columnas que superen el umbral de datos nulos</span>
<span class="n">columnas_a_eliminar</span> <span class="o">=</span> <span class="n">porcentaje_nulos</span><span class="p">[</span><span class="n">porcentaje_nulos</span> <span class="o">&gt;</span> <span class="n">umbral</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Eliminar las columnas que superen el umbral</span>
<span class="n">data_fraud</span> <span class="o">=</span> <span class="n">data_fraud</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columnas_a_eliminar</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 99999 entries, 0 to 99998
Columns: 115 entries, TransactionID to V321
dtypes: category(4), float16(100), float32(7), int16(1), int32(2), int8(1)
memory usage: 23.2 MB
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se almacena por separado la variable a predecir y las variables independientes.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_fraud</span> <span class="o">=</span> <span class="n">data_fraud</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span>

<span class="n">X_fraud</span> <span class="o">=</span> <span class="n">data_fraud</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;isFraud&#39;</span><span class="p">)</span> <span class="c1"># Se elimina la variable a predecir</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se realizará una imputación a los datos faltantes.
Se rellenara con la mediana de los datos de la variable en el caso de que se trate de una variable numérica. Para el caso de las variables categóricas se imputará con la moda de la variable.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="c1"># Identifica las columnas numéricas y categóricas</span>
<span class="n">columnas_numericas</span> <span class="o">=</span> <span class="n">X_fraud</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">columnas_categoricas</span> <span class="o">=</span> <span class="n">X_fraud</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Crea imputadores separados para las columnas numéricas y categóricas</span>
<span class="n">imputador_numericas</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">imputador_categoricas</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">)</span>

<span class="c1"># Ajusta y transforma los imputadores por separado para las columnas numéricas y categóricas</span>
<span class="n">X_fraud</span><span class="p">[</span><span class="n">columnas_numericas</span><span class="p">]</span> <span class="o">=</span> <span class="n">imputador_numericas</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_fraud</span><span class="p">[</span><span class="n">columnas_numericas</span><span class="p">])</span>
<span class="n">X_fraud</span><span class="p">[</span><span class="n">columnas_categoricas</span><span class="p">]</span> <span class="o">=</span> <span class="n">imputador_categoricas</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_fraud</span><span class="p">[</span><span class="n">columnas_categoricas</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columnas_categoricas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;ProductCD&#39;, &#39;card4&#39;, &#39;card6&#39;, &#39;P_emaildomain&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columnas_numericas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;TransactionID&#39;, &#39;TransactionDT&#39;, &#39;TransactionAmt&#39;, &#39;card1&#39;, &#39;card2&#39;,
       &#39;card3&#39;, &#39;card5&#39;, &#39;addr1&#39;, &#39;addr2&#39;, &#39;C1&#39;,
       ...
       &#39;V312&#39;, &#39;V313&#39;, &#39;V314&#39;, &#39;V315&#39;, &#39;V316&#39;, &#39;V317&#39;, &#39;V318&#39;, &#39;V319&#39;, &#39;V320&#39;,
       &#39;V321&#39;],
      dtype=&#39;object&#39;, length=110)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ya se han rellenado los datos con la mediana y la moda, y por lo tanto podemos ver que no se encuentran datos nulos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TransactionID      0
isFraud            0
TransactionDT      0
TransactionAmt     0
ProductCD          0
                  ..
V317              11
V318              11
V319              11
V320              11
V321              11
Length: 115, dtype: int64
</pre></div>
</div>
</div>
</div>
<section id="reduccion-de-dimensionalidad">
<h4>Reduccion de dimensionalidad<a class="headerlink" href="#reduccion-de-dimensionalidad" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Se separan los datos en numericos y categoricos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separar las características numéricas (si las hay)</span>
<span class="n">X_fraud_num</span> <span class="o">=</span> <span class="n">X_fraud</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">])</span>

<span class="c1"># Separar las características categóricas (si las hay)</span>
<span class="n">X_fraud_cat</span> <span class="o">=</span> <span class="n">X_fraud</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_fraud_num</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">X_fraud_cat</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 99999 entries, 0 to 99998
Columns: 110 entries, TransactionID to V321
dtypes: float64(110)
memory usage: 83.9 MB

&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 99999 entries, 0 to 99998
Data columns (total 4 columns):
 #   Column         Non-Null Count  Dtype 
---  ------         --------------  ----- 
 0   ProductCD      99999 non-null  object
 1   card4          99999 non-null  object
 2   card6          99999 non-null  object
 3   P_emaildomain  99999 non-null  object
dtypes: object(4)
memory usage: 3.1+ MB
</pre></div>
</div>
</div>
</div>
<p><em>Prueba de dependencia de Variables categoricas</em></p>
<ul class="simple">
<li><p>Aqui se realiza el test chi para determinar que variables categoricas se encuentran correlacionadas.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2_contingency</span>

<span class="c1"># Identifica las columnas categóricas después de la imputación</span>
<span class="n">columnas_categoricas_despues_de_imputar</span> <span class="o">=</span> <span class="n">data_fraud</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Establece el umbral de significancia</span>
<span class="n">umbral_correlacion</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># Función para realizar el test de chi-cuadrado</span>
<span class="k">def</span> <span class="nf">calcular_chi2</span><span class="p">(</span><span class="n">columnas_categoricas</span><span class="p">,</span> <span class="n">umbral</span><span class="p">):</span>
    <span class="n">highly_correlated_vars</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">var1</span> <span class="ow">in</span> <span class="n">columnas_categoricas</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">var2</span> <span class="ow">in</span> <span class="n">columnas_categoricas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">var1</span> <span class="o">!=</span> <span class="n">var2</span><span class="p">:</span>
                <span class="n">contingency_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">data_fraud</span><span class="p">[</span><span class="n">var1</span><span class="p">],</span> <span class="n">data_fraud</span><span class="p">[</span><span class="n">var2</span><span class="p">])</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">chi2_contingency</span><span class="p">(</span><span class="n">contingency_table</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chi2</span> <span class="o">&gt;</span> <span class="n">umbral</span><span class="p">:</span>
                    <span class="n">highly_correlated_vars</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">highly_correlated_vars</span><span class="p">))</span>

<span class="c1"># Calcular las correlaciones de chi-cuadrado inicialmente</span>
<span class="n">correlated_vars</span> <span class="o">=</span> <span class="n">calcular_chi2</span><span class="p">(</span><span class="n">columnas_categoricas_despues_de_imputar</span><span class="p">,</span> <span class="n">umbral_correlacion</span><span class="p">)</span>

<span class="c1"># Elimina una sola columna altamente correlacionada y vuelve a calcular</span>
<span class="k">if</span> <span class="n">correlated_vars</span><span class="p">:</span>
    <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">correlated_vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">var1</span> <span class="ow">in</span> <span class="n">data_fraud</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">data_fraud</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">var2</span> <span class="ow">in</span> <span class="n">data_fraud</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">data_fraud</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Proceso completado. Se eliminó una columna altamente correlacionada.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Proceso completado. Se eliminó una columna altamente correlacionada.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 99999 entries, 0 to 99998
Columns: 115 entries, TransactionID to V321
dtypes: category(4), float16(100), float32(7), int16(1), int32(2), int8(1)
memory usage: 23.2 MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_fraud</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;y_fraud.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="eliminacion-de-columnas-numericas-altamente-correlacionadas">
<h4>Eliminación de columnas numericas altamente correlacionadas.<a class="headerlink" href="#eliminacion-de-columnas-numericas-altamente-correlacionadas" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Se aplica la funcion VIF</p></li>
</ul>
<ul class="simple">
<li><p>Se eliminará los 5 VIF mas altos para cada ciclo del proceso y que sean a su vez mayor que 5, esto con el proposito de reducir el tiempo de computo.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>

<span class="c1"># Define la función vif</span>
<span class="k">def</span> <span class="nf">vif_n</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columnas</span><span class="p">):</span>
    <span class="n">vif1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">vif1</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columnas</span>
    <span class="n">vif1</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">return</span> <span class="n">vif1</span>

<span class="n">columnas_numericas</span> <span class="o">=</span> <span class="n">X_fraud_num</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># Convierte el índice en una lista</span>

<span class="n">columnas_a_eliminar</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">vif1</span> <span class="o">=</span> <span class="n">vif_n</span><span class="p">(</span><span class="n">X_fraud_num</span><span class="p">,</span> <span class="n">columnas_numericas</span><span class="p">)</span>
    <span class="n">vif1_mayores_5</span> <span class="o">=</span> <span class="n">vif1</span><span class="p">[</span><span class="n">vif1</span><span class="p">[</span><span class="s1">&#39;VIF&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">vif1_mayores_5</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">break</span>
    
    <span class="n">columnas_seleccionadas</span> <span class="o">=</span> <span class="n">vif1_mayores_5</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;VIF&#39;</span><span class="p">)[</span><span class="s1">&#39;Variable&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">columnas_a_eliminar</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">columnas_seleccionadas</span><span class="p">)</span>
    
    <span class="n">X_fraud_num</span> <span class="o">=</span> <span class="n">X_fraud_num</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columnas_seleccionadas</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columnas_seleccionadas</span><span class="p">:</span>
        <span class="n">columnas_numericas</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Eliminadas:&quot;</span><span class="p">,</span> <span class="n">columnas_seleccionadas</span><span class="p">)</span>

<span class="c1"># Al finalizar, &#39;columnas_a_eliminar&#39; contendrá las columnas numéricas eliminadas de 5 en 5</span>
<span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Eliminadas: [&#39;V107&#39;, &#39;V127&#39;, &#39;V128&#39;, &#39;V133&#39;, &#39;V134&#39;]
Eliminadas: [&#39;V96&#39;, &#39;V307&#39;, &#39;V317&#39;, &#39;TransactionID&#39;, &#39;V305&#39;]
Eliminadas: [&#39;V280&#39;, &#39;V295&#39;, &#39;C12&#39;, &#39;V119&#39;, &#39;C7&#39;]
Eliminadas: [&#39;V97&#39;, &#39;C11&#39;, &#39;V103&#39;, &#39;V122&#39;, &#39;V120&#39;]
Eliminadas: [&#39;V306&#39;, &#39;V308&#39;, &#39;V113&#39;, &#39;V117&#39;, &#39;V118&#39;]
Eliminadas: [&#39;C8&#39;, &#39;C4&#39;, &#39;C10&#39;, &#39;V108&#39;, &#39;V110&#39;]
Eliminadas: [&#39;V111&#39;, &#39;C6&#39;, &#39;V126&#39;, &#39;V112&#39;, &#39;C14&#39;]
Eliminadas: [&#39;V116&#39;, &#39;V114&#39;, &#39;V279&#39;, &#39;V95&#39;, &#39;V121&#39;]
Eliminadas: [&#39;V321&#39;, &#39;C2&#39;, &#39;V320&#39;, &#39;V109&#39;, &#39;V137&#39;]
Eliminadas: [&#39;V125&#39;, &#39;V123&#39;, &#39;addr2&#39;, &#39;card3&#39;, &#39;V294&#39;]
Eliminadas: [&#39;V304&#39;, &#39;V115&#39;, &#39;V302&#39;, &#39;C13&#39;, &#39;V292&#39;]
Eliminadas: [&#39;V290&#39;, &#39;V135&#39;, &#39;V136&#39;, &#39;V300&#39;, &#39;V301&#39;]
Eliminadas: [&#39;V298&#39;, &#39;V315&#39;, &#39;card5&#39;, &#39;V106&#39;, &#39;V100&#39;]
Eliminadas: [&#39;V124&#39;, &#39;V285&#39;, &#39;V289&#39;, &#39;V312&#39;, &#39;V288&#39;]
Eliminadas: [&#39;V282&#39;, &#39;V130&#39;, &#39;V291&#39;, &#39;V316&#39;, &#39;V293&#39;]
Eliminadas: [&#39;V284&#39;, &#39;addr1&#39;, &#39;C9&#39;, &#39;C5&#39;, &#39;V309&#39;]
Eliminadas: [&#39;V297&#39;, &#39;V299&#39;]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se obtiene el siguiente output</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Eliminadas: [&#39;V107&#39;, &#39;V127&#39;, &#39;V128&#39;, &#39;V133&#39;, &#39;V134&#39;]</span>
<span class="sd">Eliminadas: [&#39;V96&#39;, &#39;V307&#39;, &#39;V317&#39;, &#39;TransactionID&#39;, &#39;V305&#39;]</span>
<span class="sd">Eliminadas: [&#39;V280&#39;, &#39;V295&#39;, &#39;C12&#39;, &#39;V119&#39;, &#39;C7&#39;]</span>
<span class="sd">Eliminadas: [&#39;V97&#39;, &#39;C11&#39;, &#39;V103&#39;, &#39;V122&#39;, &#39;V120&#39;]</span>
<span class="sd">Eliminadas: [&#39;V306&#39;, &#39;V308&#39;, &#39;V113&#39;, &#39;V117&#39;, &#39;V118&#39;]</span>
<span class="sd">Eliminadas: [&#39;C8&#39;, &#39;C4&#39;, &#39;C10&#39;, &#39;V108&#39;, &#39;V110&#39;]</span>
<span class="sd">Eliminadas: [&#39;V111&#39;, &#39;C6&#39;, &#39;V126&#39;, &#39;V112&#39;, &#39;C14&#39;]</span>
<span class="sd">Eliminadas: [&#39;V116&#39;, &#39;V114&#39;, &#39;V279&#39;, &#39;V95&#39;, &#39;V121&#39;]</span>
<span class="sd">Eliminadas: [&#39;V321&#39;, &#39;C2&#39;, &#39;V320&#39;, &#39;V109&#39;, &#39;V137&#39;]</span>
<span class="sd">Eliminadas: [&#39;V125&#39;, &#39;V123&#39;, &#39;addr2&#39;, &#39;card3&#39;, &#39;V294&#39;]</span>
<span class="sd">Eliminadas: [&#39;V304&#39;, &#39;V115&#39;, &#39;V302&#39;, &#39;C13&#39;, &#39;V292&#39;]</span>
<span class="sd">Eliminadas: [&#39;V290&#39;, &#39;V135&#39;, &#39;V136&#39;, &#39;V300&#39;, &#39;V301&#39;]</span>
<span class="sd">Eliminadas: [&#39;V298&#39;, &#39;V315&#39;, &#39;card5&#39;, &#39;V106&#39;, &#39;V100&#39;]</span>
<span class="sd">Eliminadas: [&#39;V124&#39;, &#39;V285&#39;, &#39;V289&#39;, &#39;V312&#39;, &#39;V288&#39;]</span>
<span class="sd">Eliminadas: [&#39;V282&#39;, &#39;V130&#39;, &#39;V291&#39;, &#39;V316&#39;, &#39;V293&#39;]</span>
<span class="sd">Eliminadas: [&#39;V284&#39;, &#39;addr1&#39;, &#39;C9&#39;, &#39;C5&#39;, &#39;V309&#39;]</span>
<span class="sd">Eliminadas: [&#39;V297&#39;, &#39;V299&#39;]&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#X_fraud_num.to_csv(&#39;X_fraud_num_red.csv&#39;, index=False)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_fraud_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;X_fraud_num.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_fraud_num</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 99999 entries, 0 to 99998
Data columns (total 28 columns):
 #   Column          Non-Null Count  Dtype  
---  ------          --------------  -----  
 0   TransactionDT   99999 non-null  float64
 1   TransactionAmt  99999 non-null  float64
 2   card1           99999 non-null  float64
 3   card2           99999 non-null  float64
 4   C1              99999 non-null  float64
 5   C3              99999 non-null  float64
 6   D1              99999 non-null  float64
 7   V98             99999 non-null  float64
 8   V99             99999 non-null  float64
 9   V101            99999 non-null  float64
 10  V102            99999 non-null  float64
 11  V104            99999 non-null  float64
 12  V105            99999 non-null  float64
 13  V129            99999 non-null  float64
 14  V131            99999 non-null  float64
 15  V132            99999 non-null  float64
 16  V281            99999 non-null  float64
 17  V283            99999 non-null  float64
 18  V286            99999 non-null  float64
 19  V287            99999 non-null  float64
 20  V296            99999 non-null  float64
 21  V303            99999 non-null  float64
 22  V310            99999 non-null  float64
 23  V311            99999 non-null  float64
 24  V313            99999 non-null  float64
 25  V314            99999 non-null  float64
 26  V318            99999 non-null  float64
 27  V319            99999 non-null  float64
dtypes: float64(28)
memory usage: 21.4 MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcula la matriz de correlación</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">X_fraud_num</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Visualizar la matriz de correlación</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Matriz de Correlación&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/59e3af9e388b64d009825fe607ed658721bc707f0ced02c396d84b6fb2989fb1.png" src="_images/59e3af9e388b64d009825fe607ed658721bc707f0ced02c396d84b6fb2989fb1.png" />
</div>
</div>
<ul class="simple">
<li><p>Convertir las columnas categoricas en numericas.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>


<span class="c1"># Codifica las columnas categóricas en One-Hot utilizando get_dummies</span>
<span class="n">data_encoded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data_fraud</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columnas_categoricas</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_encoded</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="kc">False</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="analisis-de-dataset-reducido">
<h3>Analisis de dataset reducido<a class="headerlink" href="#analisis-de-dataset-reducido" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_fraud</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;X_fraud reducido.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">c</span>:\Users\Rirub\OneDrive - Universidad del Norte\MAESTRIA\MachineLearningUN\Parcial_ML_aapineda\docs\notebooks_guardado_2.ipynb Cell 48 line 1
<span class="o">----&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;vscode-notebook-cell:/c%3A/Users/Rirub/OneDrive%20-%20Universidad</span><span class="si">%20d</span><span class="s1">el%20Norte/MAESTRIA/MachineLearningUN/Parcial_ML_aapineda/docs/notebooks_guardado_2.ipynb#Y101sZmlsZQ%3D%3D?line=0&#39;</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="n">X_fraud</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;X_fraud reducido.csv&#39;</span><span class="p">)</span>

<span class="nn">File c:\Users\Rirub\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py:948,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">    </span><span class="mi">935</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">936</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">937</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">944</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">945</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">946</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">948</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File c:\Users\Rirub\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py:611,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">610</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">611</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">613</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">614</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File c:\Users\Rirub\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py:1448,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1445</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1447</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1448</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File c:\Users\Rirub\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py:1705,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1703</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1704</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1705</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1706</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1707</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1708</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1709</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1710</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1711</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1712</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1713</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1714</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1715</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1716</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File c:\Users\Rirub\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\common.py:863,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">863</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">864</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">865</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">866</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">867</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">870</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">871</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;X_fraud reducido.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>

<span class="c1"># X_fraud es la matriz de características, excluyendo la variable objetivo</span>

<span class="c1"># Calcula el VIF inicial</span>
<span class="n">vif</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_fraud</span><span class="o">.</span><span class="n">columns</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X_fraud</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_fraud</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>


<span class="k">while</span> <span class="n">vif</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
    <span class="c1"># Encuentra la variable con el VIF máximo</span>
    <span class="n">max_vif_variable</span> <span class="o">=</span> <span class="n">vif</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">vif</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="s2">&quot;Variable&quot;</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">max_vif_variable</span><span class="p">)</span>
    <span class="c1"># Elimina la variable con el VIF máximo del DataFrame original</span>
    <span class="n">X_fraud</span> <span class="o">=</span> <span class="n">X_fraud</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">max_vif_variable</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Calcula el nuevo VIF</span>
    <span class="n">vif</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">vif</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_fraud</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">vif</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X_fraud</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_fraud</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Vemos que el maximo VIF es menor a 5, por lo que hemos terminado con la reducción.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">vif</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variable    card6_credit
VIF             4.367635
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_fraud</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;X_fraud reducido2.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_fraud</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;X_fraud reducido2.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_fraud</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;y_fraud.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Al concluir el proceso de comprobación de multicolinealidad, observamos que solo un reducido número de columnas; 84 en este caso permanecen en el conjunto de datos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_fraud</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 99999 entries, 0 to 99998
Data columns (total 84 columns):
 #   Column                          Non-Null Count  Dtype  
---  ------                          --------------  -----  
 0   TransactionDT                   99999 non-null  float64
 1   TransactionAmt                  99999 non-null  float64
 2   card1                           99999 non-null  float64
 3   C3                              99999 non-null  float64
 4   C9                              99999 non-null  float64
 5   C14                             99999 non-null  float64
 6   D4                              99999 non-null  float64
 7   D10                             99999 non-null  float64
 8   D15                             99999 non-null  float64
 9   V12                             99999 non-null  float64
 10  V16                             99999 non-null  float64
 11  V22                             99999 non-null  float64
 12  V52                             99999 non-null  float64
 13  V53                             99999 non-null  float64
 14  V70                             99999 non-null  float64
 15  V99                             99999 non-null  float64
 16  V101                            99999 non-null  float64
 17  V102                            99999 non-null  float64
 18  V106                            99999 non-null  float64
 19  V133                            99999 non-null  float64
 20  V281                            99999 non-null  float64
 21  V286                            99999 non-null  float64
 22  V287                            99999 non-null  float64
 23  V289                            99999 non-null  float64
 24  V291                            99999 non-null  float64
 25  V303                            99999 non-null  float64
 26  ProductCD_H                     99999 non-null  float64
 27  ProductCD_S                     99999 non-null  float64
 28  card4_mastercard                99999 non-null  float64
 29  card6_credit                    99999 non-null  float64
 30  P_emaildomain_centurylink.net   99999 non-null  float64
 31  P_emaildomain_cfl.rr.com        99999 non-null  float64
 32  P_emaildomain_charter.net       99999 non-null  float64
 33  P_emaildomain_comcast.net       99999 non-null  float64
 34  P_emaildomain_cox.net           99999 non-null  float64
 35  P_emaildomain_earthlink.net     99999 non-null  float64
 36  P_emaildomain_embarqmail.com    99999 non-null  float64
 37  P_emaildomain_frontier.com      99999 non-null  float64
 38  P_emaildomain_frontiernet.net   99999 non-null  float64
 39  P_emaildomain_gmail             99999 non-null  float64
 40  P_emaildomain_gmail.com         99999 non-null  float64
 41  P_emaildomain_gmx.de            99999 non-null  float64
 42  P_emaildomain_hotmail.co.uk     99999 non-null  float64
 43  P_emaildomain_hotmail.com       99999 non-null  float64
 44  P_emaildomain_hotmail.de        99999 non-null  float64
 45  P_emaildomain_hotmail.es        99999 non-null  float64
 46  P_emaildomain_hotmail.fr        99999 non-null  float64
 47  P_emaildomain_icloud.com        99999 non-null  float64
 48  P_emaildomain_juno.com          99999 non-null  float64
 49  P_emaildomain_live.com          99999 non-null  float64
 50  P_emaildomain_live.com.mx       99999 non-null  float64
 51  P_emaildomain_live.fr           99999 non-null  float64
 52  P_emaildomain_mac.com           99999 non-null  float64
 53  P_emaildomain_mail.com          99999 non-null  float64
 54  P_emaildomain_me.com            99999 non-null  float64
 55  P_emaildomain_msn.com           99999 non-null  float64
 56  P_emaildomain_netzero.com       99999 non-null  float64
 57  P_emaildomain_netzero.net       99999 non-null  float64
 58  P_emaildomain_optonline.net     99999 non-null  float64
 59  P_emaildomain_outlook.com       99999 non-null  float64
 60  P_emaildomain_outlook.es        99999 non-null  float64
 61  P_emaildomain_prodigy.net.mx    99999 non-null  float64
 62  P_emaildomain_protonmail.com    99999 non-null  float64
 63  P_emaildomain_ptd.net           99999 non-null  float64
 64  P_emaildomain_q.com             99999 non-null  float64
 65  P_emaildomain_roadrunner.com    99999 non-null  float64
 66  P_emaildomain_rocketmail.com    99999 non-null  float64
 67  P_emaildomain_sbcglobal.net     99999 non-null  float64
 68  P_emaildomain_sc.rr.com         99999 non-null  float64
 69  P_emaildomain_servicios-ta.com  99999 non-null  float64
 70  P_emaildomain_suddenlink.net    99999 non-null  float64
 71  P_emaildomain_twc.com           99999 non-null  float64
 72  P_emaildomain_verizon.net       99999 non-null  float64
 73  P_emaildomain_web.de            99999 non-null  float64
 74  P_emaildomain_windstream.net    99999 non-null  float64
 75  P_emaildomain_yahoo.co.jp       99999 non-null  float64
 76  P_emaildomain_yahoo.co.uk       99999 non-null  float64
 77  P_emaildomain_yahoo.com         99999 non-null  float64
 78  P_emaildomain_yahoo.com.mx      99999 non-null  float64
 79  P_emaildomain_yahoo.de          99999 non-null  float64
 80  P_emaildomain_yahoo.es          99999 non-null  float64
 81  P_emaildomain_yahoo.fr          99999 non-null  float64
 82  P_emaildomain_ymail.com         99999 non-null  float64
 83  M6_T                            99999 non-null  float64
dtypes: float64(84)
memory usage: 64.1 MB
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Aqui podemos observar la matriz de correlación reducida y efectivamente observamos que las variables no tienen correlación entre ellas, y el grafico es en su mayoria azul.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcula la matriz de correlación</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">X_fraud</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Visualizar la matriz de correlación</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Matriz de Correlación&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/655af1b8df3f8746a749a8dd88126ef9269e93d0173122aeb0f373dc8a8948f6.png" src="_images/655af1b8df3f8746a749a8dd88126ef9269e93d0173122aeb0f373dc8a8948f6.png" />
</div>
</div>
</section>
</section>
<section id="eda-fraude-con-datos-reducidos">
<h2>EDA FRAUDE CON DATOS REDUCIDOS<a class="headerlink" href="#eda-fraude-con-datos-reducidos" title="Permalink to this heading">#</a></h2>
<p>Detección de fraude
Los datos proceden de transacciones reales de comercio electrónico de Vesta y contienen una amplia gama
de características, desde el tipo de dispositivo hasta las características del producto. El objetivo principal es
mejorar la eficacia de las alertas de transacciones fraudulentas para millones de personas en todo el mundo,
ayudando a cientos de miles de empresas a reducir sus pérdidas por fraude y aumentar sus ingresos. Y, por
supuesto, ahorrará a muchas personas la molestia de los falsos positivos.</p>
<ul class="simple">
<li><p>TransactionDT : Intervalo de tiempo a partir de una fecha y hora de referencia</p></li>
<li><p>TransactionAMT : Importe del pago de la transacción en USD</p></li>
<li><p>ProductCD: Código de producto, el producto de cada transacción</p></li>
<li><p>card1 - card6 : Información de la tarjeta de pago, como tipo de tarjeta, categoría de tarjeta, banco
emisor, país, etc.</p></li>
<li><p>addr: Dirección</p></li>
<li><p>dist: Distancia</p></li>
<li><p>P_ and (R_) emaildomain: Dominio de correo electrónico del comprador y del destinatario</p></li>
<li><p>C1-C14 : Recuento, cuántas direcciones se encuentran asociadas a la tarjeta de pago, etc. El significado
real está codificado.</p></li>
<li><p>D1-D15: Intervalo de tiempo, como los días transcurridos entre la transacción anterior, etc.</p></li>
<li><p>M1-M9: Coinciden, como los nombres en la tarjeta y la dirección, etc.</p></li>
<li><p>Vxxx: Vesta ofrece una gran variedad de funciones, como la clasificación, el recuento y otras relaciones
entre entidades.</p></li>
<li><p>DeviceType: Codificada. Información de identidad o conexión de red (IP, ISP, Proxy, etc) o firma digital</p></li>
<li><p>DeviceInfo: Codificada. Información de identidad o conexión de red (IP, ISP, Proxy, etc) o firma digital</p></li>
<li><p>id_12 - id_38: Codificada. Información de identidad o conexión de red (IP, ISP, Proxy, etc) o firma
digital</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">y_fraud</span><span class="p">,</span> <span class="n">X_fraud</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lista de nombres de columnas con tipo float16</span>
<span class="n">columnas_float16</span> <span class="o">=</span> <span class="n">data_fraud</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float16&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Convierte esas columnas a float32</span>
<span class="n">data_fraud</span><span class="p">[</span><span class="n">columnas_float16</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_fraud</span><span class="p">[</span><span class="n">columnas_float16</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se hace una muestra de las primeros 5 columnas para ver los datos, encontramos variables numericas y dummy.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>isFraud</th>
      <th>TransactionDT</th>
      <th>TransactionAmt</th>
      <th>card1</th>
      <th>C3</th>
      <th>C9</th>
      <th>C14</th>
      <th>D4</th>
      <th>D10</th>
      <th>D15</th>
      <th>...</th>
      <th>P_emaildomain_windstream.net</th>
      <th>P_emaildomain_yahoo.co.jp</th>
      <th>P_emaildomain_yahoo.co.uk</th>
      <th>P_emaildomain_yahoo.com</th>
      <th>P_emaildomain_yahoo.com.mx</th>
      <th>P_emaildomain_yahoo.de</th>
      <th>P_emaildomain_yahoo.es</th>
      <th>P_emaildomain_yahoo.fr</th>
      <th>P_emaildomain_ymail.com</th>
      <th>M6_T</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>86400.0</td>
      <td>68.5</td>
      <td>13930.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>20.0</td>
      <td>13.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>86401.0</td>
      <td>29.0</td>
      <td>2756.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>86469.0</td>
      <td>59.0</td>
      <td>4664.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>315.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>86499.0</td>
      <td>50.0</td>
      <td>18130.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>94.0</td>
      <td>84.0</td>
      <td>111.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>86506.0</td>
      <td>50.0</td>
      <td>4496.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>20.0</td>
      <td>14.0</td>
      <td>45.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 85 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Se muestra la información de las columnas del dataset, vemos que hay 84, de las cuales la primera es la variable a predecir, contiene 100.000 valores para cada columna.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ver información sobre las columnas y tipos de variables</span>
<span class="n">data_fraud</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 99999 entries, 0 to 99998
Data columns (total 85 columns):
 #   Column                          Non-Null Count  Dtype  
---  ------                          --------------  -----  
 0   isFraud                         99999 non-null  float64
 1   TransactionDT                   99999 non-null  float64
 2   TransactionAmt                  99999 non-null  float64
 3   card1                           99999 non-null  float64
 4   C3                              99999 non-null  float64
 5   C9                              99999 non-null  float64
 6   C14                             99999 non-null  float64
 7   D4                              99999 non-null  float64
 8   D10                             99999 non-null  float64
 9   D15                             99999 non-null  float64
 10  V12                             99999 non-null  float64
 11  V16                             99999 non-null  float64
 12  V22                             99999 non-null  float64
 13  V52                             99999 non-null  float64
 14  V53                             99999 non-null  float64
 15  V70                             99999 non-null  float64
 16  V99                             99999 non-null  float64
 17  V101                            99999 non-null  float64
 18  V102                            99999 non-null  float64
 19  V106                            99999 non-null  float64
 20  V133                            99999 non-null  float64
 21  V281                            99999 non-null  float64
 22  V286                            99999 non-null  float64
 23  V287                            99999 non-null  float64
 24  V289                            99999 non-null  float64
 25  V291                            99999 non-null  float64
 26  V303                            99999 non-null  float64
 27  ProductCD_H                     99999 non-null  float64
 28  ProductCD_S                     99999 non-null  float64
 29  card4_mastercard                99999 non-null  float64
 30  card6_credit                    99999 non-null  float64
 31  P_emaildomain_centurylink.net   99999 non-null  float64
 32  P_emaildomain_cfl.rr.com        99999 non-null  float64
 33  P_emaildomain_charter.net       99999 non-null  float64
 34  P_emaildomain_comcast.net       99999 non-null  float64
 35  P_emaildomain_cox.net           99999 non-null  float64
 36  P_emaildomain_earthlink.net     99999 non-null  float64
 37  P_emaildomain_embarqmail.com    99999 non-null  float64
 38  P_emaildomain_frontier.com      99999 non-null  float64
 39  P_emaildomain_frontiernet.net   99999 non-null  float64
 40  P_emaildomain_gmail             99999 non-null  float64
 41  P_emaildomain_gmail.com         99999 non-null  float64
 42  P_emaildomain_gmx.de            99999 non-null  float64
 43  P_emaildomain_hotmail.co.uk     99999 non-null  float64
 44  P_emaildomain_hotmail.com       99999 non-null  float64
 45  P_emaildomain_hotmail.de        99999 non-null  float64
 46  P_emaildomain_hotmail.es        99999 non-null  float64
 47  P_emaildomain_hotmail.fr        99999 non-null  float64
 48  P_emaildomain_icloud.com        99999 non-null  float64
 49  P_emaildomain_juno.com          99999 non-null  float64
 50  P_emaildomain_live.com          99999 non-null  float64
 51  P_emaildomain_live.com.mx       99999 non-null  float64
 52  P_emaildomain_live.fr           99999 non-null  float64
 53  P_emaildomain_mac.com           99999 non-null  float64
 54  P_emaildomain_mail.com          99999 non-null  float64
 55  P_emaildomain_me.com            99999 non-null  float64
 56  P_emaildomain_msn.com           99999 non-null  float64
 57  P_emaildomain_netzero.com       99999 non-null  float64
 58  P_emaildomain_netzero.net       99999 non-null  float64
 59  P_emaildomain_optonline.net     99999 non-null  float64
 60  P_emaildomain_outlook.com       99999 non-null  float64
 61  P_emaildomain_outlook.es        99999 non-null  float64
 62  P_emaildomain_prodigy.net.mx    99999 non-null  float64
 63  P_emaildomain_protonmail.com    99999 non-null  float64
 64  P_emaildomain_ptd.net           99999 non-null  float64
 65  P_emaildomain_q.com             99999 non-null  float64
 66  P_emaildomain_roadrunner.com    99999 non-null  float64
 67  P_emaildomain_rocketmail.com    99999 non-null  float64
 68  P_emaildomain_sbcglobal.net     99999 non-null  float64
 69  P_emaildomain_sc.rr.com         99999 non-null  float64
 70  P_emaildomain_servicios-ta.com  99999 non-null  float64
 71  P_emaildomain_suddenlink.net    99999 non-null  float64
 72  P_emaildomain_twc.com           99999 non-null  float64
 73  P_emaildomain_verizon.net       99999 non-null  float64
 74  P_emaildomain_web.de            99999 non-null  float64
 75  P_emaildomain_windstream.net    99999 non-null  float64
 76  P_emaildomain_yahoo.co.jp       99999 non-null  float64
 77  P_emaildomain_yahoo.co.uk       99999 non-null  float64
 78  P_emaildomain_yahoo.com         99999 non-null  float64
 79  P_emaildomain_yahoo.com.mx      99999 non-null  float64
 80  P_emaildomain_yahoo.de          99999 non-null  float64
 81  P_emaildomain_yahoo.es          99999 non-null  float64
 82  P_emaildomain_yahoo.fr          99999 non-null  float64
 83  P_emaildomain_ymail.com         99999 non-null  float64
 84  M6_T                            99999 non-null  float64
dtypes: float64(85)
memory usage: 64.8 MB
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Aqui se describe el dataset, se observa que la variable a predecir tiene una media 0.025, es decir que estamos con una serie bastante desbalanceada lo cual complica la tarea de clasificación. Se podria explorar utilizando tecnicas de oversampling, sin embargo debido a motivos computacionales se dejara de esta forma. Otra tecnica posible seria realizar un subsampling, eliminado la clase mas común sin embargo se puede perder información util.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_fraud</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>isFraud</th>
      <th>TransactionDT</th>
      <th>TransactionAmt</th>
      <th>card1</th>
      <th>C3</th>
      <th>C9</th>
      <th>C14</th>
      <th>D4</th>
      <th>D10</th>
      <th>D15</th>
      <th>...</th>
      <th>P_emaildomain_windstream.net</th>
      <th>P_emaildomain_yahoo.co.jp</th>
      <th>P_emaildomain_yahoo.co.uk</th>
      <th>P_emaildomain_yahoo.com</th>
      <th>P_emaildomain_yahoo.com.mx</th>
      <th>P_emaildomain_yahoo.de</th>
      <th>P_emaildomain_yahoo.es</th>
      <th>P_emaildomain_yahoo.fr</th>
      <th>P_emaildomain_ymail.com</th>
      <th>M6_T</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>99999.00000</td>
      <td>9.999900e+04</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>...</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
      <td>99999.00000</td>
      <td>99999.000000</td>
      <td>99999.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.02561</td>
      <td>1.135115e+06</td>
      <td>130.744063</td>
      <td>9878.395924</td>
      <td>0.012320</td>
      <td>3.257333</td>
      <td>16.665407</td>
      <td>77.690707</td>
      <td>84.229792</td>
      <td>113.087861</td>
      <td>...</td>
      <td>0.000540</td>
      <td>0.000010</td>
      <td>0.000160</td>
      <td>0.158832</td>
      <td>0.002920</td>
      <td>0.000070</td>
      <td>0.000190</td>
      <td>0.00027</td>
      <td>0.003690</td>
      <td>0.251573</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.15797</td>
      <td>5.733446e+05</td>
      <td>206.021973</td>
      <td>4933.401871</td>
      <td>0.133299</td>
      <td>13.966058</td>
      <td>102.565735</td>
      <td>135.654863</td>
      <td>144.440652</td>
      <td>154.032942</td>
      <td>...</td>
      <td>0.023232</td>
      <td>0.003162</td>
      <td>0.012648</td>
      <td>0.365521</td>
      <td>0.053959</td>
      <td>0.008366</td>
      <td>0.013783</td>
      <td>0.01643</td>
      <td>0.060634</td>
      <td>0.433919</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.00000</td>
      <td>8.640000e+04</td>
      <td>0.292000</td>
      <td>1001.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-122.000000</td>
      <td>0.000000</td>
      <td>-83.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.00000</td>
      <td>6.537475e+05</td>
      <td>45.000000</td>
      <td>6020.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>8.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.00000</td>
      <td>1.189336e+06</td>
      <td>75.000000</td>
      <td>9656.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>20.000000</td>
      <td>14.000000</td>
      <td>45.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.00000</td>
      <td>1.643436e+06</td>
      <td>136.000000</td>
      <td>14290.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>34.000000</td>
      <td>84.000000</td>
      <td>145.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.00000</td>
      <td>2.006177e+06</td>
      <td>4828.000000</td>
      <td>18400.000000</td>
      <td>16.000000</td>
      <td>194.000000</td>
      <td>1429.000000</td>
      <td>721.000000</td>
      <td>721.000000</td>
      <td>721.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.00000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 85 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Se toman 5 variables de interes para confirmar su comportamiento y ver su relación con la variable independiente. En este caso: ‘TransactionDT’, ‘TransactionAmt’, ‘card1’, ‘C3’, ‘C9’.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Selección de las 4 variables de interés</span>
<span class="n">variables_seleccionadas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">,</span> <span class="s1">&#39;TransactionDT&#39;</span><span class="p">,</span> <span class="s1">&#39;TransactionAmt&#39;</span><span class="p">,</span> <span class="s1">&#39;card1&#39;</span><span class="p">,</span> <span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="s1">&#39;C9&#39;</span><span class="p">]</span>

<span class="c1"># Crear un subconjunto de datos con las variables seleccionadas</span>
<span class="n">subset_data</span> <span class="o">=</span> <span class="n">data_fraud</span><span class="p">[</span><span class="n">variables_seleccionadas</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">kurtosis</span>

<span class="n">num_cols</span> <span class="o">=</span> <span class="n">subset_data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Column: &#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skew:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">subset_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Kurtosis: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">subset_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">subset_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">subset_data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  isFraud
Skew: 6.01
Kurtosis:  34.07
</pre></div>
</div>
<img alt="_images/3a6b2edf80522985ebad657a00190fba3f51f065916ce388e0a0673752912f33.png" src="_images/3a6b2edf80522985ebad657a00190fba3f51f065916ce388e0a0673752912f33.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  TransactionDT
Skew: -0.19
Kurtosis:  -1.22
</pre></div>
</div>
<img alt="_images/3163fd1d48822b2df18d06fa479956b6c003ee9fb5a045e0e2756a47d0ceadbe.png" src="_images/3163fd1d48822b2df18d06fa479956b6c003ee9fb5a045e0e2756a47d0ceadbe.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  TransactionAmt
Skew: 6.78
Kurtosis:  70.15
</pre></div>
</div>
<img alt="_images/75a28c98b892478195803b7ebdacf56dc97795773214ea4781a87d22aca1e213.png" src="_images/75a28c98b892478195803b7ebdacf56dc97795773214ea4781a87d22aca1e213.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  card1
Skew: -0.03
Kurtosis:  -1.15
</pre></div>
</div>
<img alt="_images/05df83c4a2448e158ab0074321d940ba84db49301c83a94aafe9a936c2239b16.png" src="_images/05df83c4a2448e158ab0074321d940ba84db49301c83a94aafe9a936c2239b16.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  C3
Skew: 30.08
Kurtosis:  2495.45
</pre></div>
</div>
<img alt="_images/f2f266d15a65894e5e0ddbedc163f19ce9ed4b98ca6f142ebac2eee8d2f5c810.png" src="_images/f2f266d15a65894e5e0ddbedc163f19ce9ed4b98ca6f142ebac2eee8d2f5c810.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  C9
Skew: 6.86
Kurtosis:  54.15
</pre></div>
</div>
<img alt="_images/6c54987b988477a741bb536758155d1899644b99026fb39513ba5a6d052c1601.png" src="_images/6c54987b988477a741bb536758155d1899644b99026fb39513ba5a6d052c1601.png" />
</div>
</div>
<ul class="simple">
<li><p>Vemos que la caracteristica C3 y C9, que corresponde a las direcciones asociadas se concentran en pocas direcciones y se encuentran varios outlayer pero principalmente se concentra en pocas direcciones asociadas.</p></li>
</ul>
<ul class="simple">
<li><p>De los graficos anteriores podemos ver que la clase a predecir “isFraud” se encuentra desbalanceada con muy pocos datos de fraude. Lo cual tiene sentido, ya que para operaciones bancarias que se presente fraude no es tan frecuente.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;isFraud&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">subset_data</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#3f3e6fd1&quot;</span><span class="p">,</span> <span class="s2">&quot;#85c6a9&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span> <span class="s1">&#39;Fraude&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Observaciones de Fraude&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Numero de observaciones&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4697f7dd36a65aac2660e9f3a55cd22babe344d1e79327563736d51ceb19bc8d.png" src="_images/4697f7dd36a65aac2660e9f3a55cd22babe344d1e79327563736d51ceb19bc8d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">subset_data</span><span class="p">);</span>

<span class="n">num_cols</span> <span class="o">=</span> <span class="n">subset_data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">scatter_regplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">strx</span><span class="p">,</span> <span class="n">stry</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">strx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">stry</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">strx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">stry</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Relación entre </span><span class="si">%s</span><span class="s1"> y vel_viento&#39;</span><span class="o">%</span><span class="k">col</span>)  

<span class="n">num_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;isFraud&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">:</span>
    <span class="n">scatter_regplot</span><span class="p">(</span><span class="n">subset_data</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="s1">&#39;isFraud&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6d68b90e0a7fcc63e3785ce20d0ad3ad7712c25a42aa2b72acf7c1c17d9cfc0b.png" src="_images/6d68b90e0a7fcc63e3785ce20d0ad3ad7712c25a42aa2b72acf7c1c17d9cfc0b.png" />
<img alt="_images/f02ae9c3f7dd4c91c410ec2bf485a602094fe4ab7210d721fbcc95b62080d25f.png" src="_images/f02ae9c3f7dd4c91c410ec2bf485a602094fe4ab7210d721fbcc95b62080d25f.png" />
<img alt="_images/d4af6c1e9f663de1b8a0bff9791c41ca8addd67f1f058e64b984e6e553b01eae.png" src="_images/d4af6c1e9f663de1b8a0bff9791c41ca8addd67f1f058e64b984e6e553b01eae.png" />
<img alt="_images/e3cae6b78ff9b3c10d03a725b506ff64960468ce29c84c8321ece03b7944f939.png" src="_images/e3cae6b78ff9b3c10d03a725b506ff64960468ce29c84c8321ece03b7944f939.png" />
<img alt="_images/fe8fd043df6384424de1bd0271b1b37777e009c10b06f257a8fa8cf89f85031d.png" src="_images/fe8fd043df6384424de1bd0271b1b37777e009c10b06f257a8fa8cf89f85031d.png" />
<img alt="_images/f8bebe721a14693d3acb2f2891590fbec0372c507a923286eba5de088098fd40.png" src="_images/f8bebe721a14693d3acb2f2891590fbec0372c507a923286eba5de088098fd40.png" />
</div>
</div>
<ul class="simple">
<li><p>Tal como observamos en la parte de arriba C3 Y C9 que corresponde al numero de direcciones asociadas, parece tener una correlaccion con la caracteristica a predecir de si es fraude.</p></li>
<li><p>Por otro lado, en las otras variables no muestran una correlacción clara con que es si es Fraude.</p></li>
</ul>
</section>
<section id="wind-speed">
<h2>Wind Speed<a class="headerlink" href="#wind-speed" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_speed</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_treino_dv_df_2000_2010.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>En este Dataset se encuentran el siguiente tipo de Variables:</p>
<ul class="simple">
<li><p>HORA (UTC): Hora</p></li>
<li><p>VENTO, DIREï¿½ï¿½O HORARIA (gr) (ï¿½ (gr)): Dirección del viento horaria</p></li>
<li><p>VENTO, VELOCIDADE HORARIA (m/s): Velocidad horario del viento (m/s)</p></li>
<li><p>UMIDADE REL. MAX. NA HORA ANT. (AUT) ( %): Humedad rel. máx. hora anterior (AUT) ( %)</p></li>
<li><p>UMIDADE REL. MIN. NA HORA ANT. (AUT) ( %): Humedad rel. mín. hora anterior (AUT) ( %)</p></li>
<li><p>TEMPERATURA Mï¿½XIMA NA HORA ANT. (AUT) (ï¿½C): Temperatura máx. hora anterior (AUT) (℃)</p></li>
<li><p>TEMPERATURA Mï¿½NIMA NA HORA ANT. (AUT) (ï¿½C): Temperatura mín. hora anterior (AUT) ( ℃)</p></li>
<li><p>UMIDADE RELATIVA DO AR, HORARIA ( %): Humedad relativa horaria ( %)</p></li>
<li><p>PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB): Presión atmosférica a nivel de estación, horaria (mB)</p></li>
<li><p>PRECIPITACION TOTAL, HORARIO (mm): Precipitación total por hora (mm)</p></li>
<li><p>VENTO, RAJADA MAXIMA (m/s): Máxima ráfaga de viento (m/s)</p></li>
<li><p>PRESSï¿½O ATMOSFERICA <a class="reference external" href="http://MAX.NA">MAX.NA</a> HORA ANT. (AUT) (mB): Presión atmosférica máx. hora anterior (AUT) (mB)</p></li>
<li><p>PRESSï¿½O ATMOSFERICA <a class="reference external" href="http://MIN.NA">MIN.NA</a> HORA ANT. (AUT) (mB): Presión atmosférica mín. hora anterior (AUT) (mB)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_speed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>HORA (UTC)</th>
      <th>VENTO, DIREï¿½ï¿½O HORARIA (gr) (ï¿½ (gr))</th>
      <th>VENTO, VELOCIDADE HORARIA (m/s)</th>
      <th>UMIDADE REL. MAX. NA HORA ANT. (AUT) (%)</th>
      <th>UMIDADE REL. MIN. NA HORA ANT. (AUT) (%)</th>
      <th>TEMPERATURA Mï¿½XIMA NA HORA ANT. (AUT) (ï¿½C)</th>
      <th>TEMPERATURA Mï¿½NIMA NA HORA ANT. (AUT) (ï¿½C)</th>
      <th>UMIDADE RELATIVA DO AR, HORARIA (%)</th>
      <th>PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB)</th>
      <th>PRECIPITAï¿½ï¿½O TOTAL, HORï¿½RIO (mm)</th>
      <th>VENTO, RAJADA MAXIMA (m/s)</th>
      <th>PRESSï¿½O ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB)</th>
      <th>PRESSï¿½O ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12:00</td>
      <td>0.809017</td>
      <td>1.8</td>
      <td>69.0</td>
      <td>60.0</td>
      <td>22.6</td>
      <td>20.7</td>
      <td>61.0</td>
      <td>888.2</td>
      <td>0.0</td>
      <td>3.8</td>
      <td>888.2</td>
      <td>887.7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13:00</td>
      <td>0.965926</td>
      <td>2.7</td>
      <td>62.0</td>
      <td>55.0</td>
      <td>24.2</td>
      <td>22.5</td>
      <td>55.0</td>
      <td>888.4</td>
      <td>0.0</td>
      <td>4.7</td>
      <td>888.4</td>
      <td>888.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14:00</td>
      <td>0.891007</td>
      <td>2.0</td>
      <td>56.0</td>
      <td>50.0</td>
      <td>25.5</td>
      <td>24.3</td>
      <td>51.0</td>
      <td>888.1</td>
      <td>0.0</td>
      <td>4.9</td>
      <td>888.4</td>
      <td>888.1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15:00</td>
      <td>0.848048</td>
      <td>2.5</td>
      <td>52.0</td>
      <td>44.0</td>
      <td>27.4</td>
      <td>25.0</td>
      <td>44.0</td>
      <td>887.4</td>
      <td>0.0</td>
      <td>5.8</td>
      <td>888.1</td>
      <td>887.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16:00</td>
      <td>0.224951</td>
      <td>2.4</td>
      <td>50.0</td>
      <td>43.0</td>
      <td>27.1</td>
      <td>25.5</td>
      <td>46.0</td>
      <td>886.5</td>
      <td>0.0</td>
      <td>5.8</td>
      <td>887.4</td>
      <td>886.5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>87688</th>
      <td>19:00</td>
      <td>-0.615661</td>
      <td>5.6</td>
      <td>83.0</td>
      <td>78.0</td>
      <td>21.8</td>
      <td>21.1</td>
      <td>80.0</td>
      <td>879.1</td>
      <td>0.0</td>
      <td>12.3</td>
      <td>879.8</td>
      <td>879.1</td>
    </tr>
    <tr>
      <th>87689</th>
      <td>20:00</td>
      <td>-0.469472</td>
      <td>4.9</td>
      <td>84.0</td>
      <td>79.0</td>
      <td>21.7</td>
      <td>21.0</td>
      <td>84.0</td>
      <td>879.2</td>
      <td>0.0</td>
      <td>9.9</td>
      <td>879.2</td>
      <td>878.9</td>
    </tr>
    <tr>
      <th>87690</th>
      <td>21:00</td>
      <td>-0.484810</td>
      <td>4.5</td>
      <td>86.0</td>
      <td>82.0</td>
      <td>21.2</td>
      <td>20.6</td>
      <td>86.0</td>
      <td>879.7</td>
      <td>0.0</td>
      <td>8.9</td>
      <td>879.8</td>
      <td>879.2</td>
    </tr>
    <tr>
      <th>87691</th>
      <td>22:00</td>
      <td>-0.484810</td>
      <td>3.2</td>
      <td>88.0</td>
      <td>85.0</td>
      <td>20.6</td>
      <td>20.2</td>
      <td>88.0</td>
      <td>880.5</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>880.5</td>
      <td>879.6</td>
    </tr>
    <tr>
      <th>87692</th>
      <td>23:00</td>
      <td>-0.573576</td>
      <td>2.3</td>
      <td>95.0</td>
      <td>88.0</td>
      <td>20.2</td>
      <td>19.3</td>
      <td>95.0</td>
      <td>881.1</td>
      <td>0.6</td>
      <td>7.5</td>
      <td>881.1</td>
      <td>880.5</td>
    </tr>
  </tbody>
</table>
<p>87693 rows × 13 columns</p>
</div></div></div>
</div>
<p>Se establecen los nombres que se pondran a las columnas, que son los nombres originales pero reducidos en tamaño para su visualización.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuevos_nombres</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">,</span> <span class="s1">&#39;dir_viento&#39;</span><span class="p">,</span> <span class="s1">&#39;vel_viento&#39;</span><span class="p">,</span> <span class="s1">&#39;Humedad rel. máx&#39;</span><span class="p">,</span><span class="s1">&#39;Humedad rel. mín.&#39;</span><span class="p">,</span><span class="s1">&#39;Temp. máx&#39;</span><span class="p">,</span><span class="s1">&#39;Temp mín.&#39;</span><span class="p">,</span> <span class="s1">&#39;Humedad rel horaria&#39;</span><span class="p">,</span> <span class="s1">&#39;Presión atm&#39;</span><span class="p">,</span> <span class="s1">&#39;Precip&#39;</span><span class="p">,</span> <span class="s1">&#39;Máx ráfaga&#39;</span><span class="p">,</span> <span class="s1">&#39;Presión atm máx&#39;</span><span class="p">,</span> <span class="s1">&#39;Presión atm mín&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_speed</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">nuevos_nombres</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se muestran los primeros 5 valores para ver una muestra de los datos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_speed</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Hora</th>
      <th>dir_viento</th>
      <th>vel_viento</th>
      <th>Humedad rel. máx</th>
      <th>Humedad rel. mín.</th>
      <th>Temp. máx</th>
      <th>Temp mín.</th>
      <th>Humedad rel horaria</th>
      <th>Presión atm</th>
      <th>Precip</th>
      <th>Máx ráfaga</th>
      <th>Presión atm máx</th>
      <th>Presión atm mín</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12:00</td>
      <td>0.809017</td>
      <td>1.8</td>
      <td>69.0</td>
      <td>60.0</td>
      <td>22.6</td>
      <td>20.7</td>
      <td>61.0</td>
      <td>888.2</td>
      <td>0.0</td>
      <td>3.8</td>
      <td>888.2</td>
      <td>887.7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13:00</td>
      <td>0.965926</td>
      <td>2.7</td>
      <td>62.0</td>
      <td>55.0</td>
      <td>24.2</td>
      <td>22.5</td>
      <td>55.0</td>
      <td>888.4</td>
      <td>0.0</td>
      <td>4.7</td>
      <td>888.4</td>
      <td>888.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14:00</td>
      <td>0.891007</td>
      <td>2.0</td>
      <td>56.0</td>
      <td>50.0</td>
      <td>25.5</td>
      <td>24.3</td>
      <td>51.0</td>
      <td>888.1</td>
      <td>0.0</td>
      <td>4.9</td>
      <td>888.4</td>
      <td>888.1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15:00</td>
      <td>0.848048</td>
      <td>2.5</td>
      <td>52.0</td>
      <td>44.0</td>
      <td>27.4</td>
      <td>25.0</td>
      <td>44.0</td>
      <td>887.4</td>
      <td>0.0</td>
      <td>5.8</td>
      <td>888.1</td>
      <td>887.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16:00</td>
      <td>0.224951</td>
      <td>2.4</td>
      <td>50.0</td>
      <td>43.0</td>
      <td>27.1</td>
      <td>25.5</td>
      <td>46.0</td>
      <td>886.5</td>
      <td>0.0</td>
      <td>5.8</td>
      <td>887.4</td>
      <td>886.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Se reemplazara la columna de hora por un numero incremental de 0 al final de observaciones ya que es una serie continua.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reemplazar la columna &#39;Hora&#39; por una secuencia de números.</span>
<span class="n">wind_speed</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_speed</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 87693 entries, 0 to 87692
Data columns (total 13 columns):
 #   Column               Non-Null Count  Dtype  
---  ------               --------------  -----  
 0   Hora                 87693 non-null  int64  
 1   dir_viento           87693 non-null  float64
 2   vel_viento           87693 non-null  float64
 3   Humedad rel. máx     87693 non-null  float64
 4   Humedad rel. mín.    87693 non-null  float64
 5   Temp. máx            87693 non-null  float64
 6   Temp mín.            87693 non-null  float64
 7   Humedad rel horaria  87693 non-null  float64
 8   Presión atm          87693 non-null  float64
 9   Precip               87693 non-null  float64
 10  Máx ráfaga           87693 non-null  float64
 11  Presión atm máx      87693 non-null  float64
 12  Presión atm mín      87693 non-null  float64
dtypes: float64(12), int64(1)
memory usage: 8.7 MB
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se muestra la descripción de las columnas. Vemos que tenemos 87692 observaciones de velocidad de viento.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_speed</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Hora</th>
      <th>dir_viento</th>
      <th>vel_viento</th>
      <th>Humedad rel. máx</th>
      <th>Humedad rel. mín.</th>
      <th>Temp. máx</th>
      <th>Temp mín.</th>
      <th>Humedad rel horaria</th>
      <th>Presión atm</th>
      <th>Precip</th>
      <th>Máx ráfaga</th>
      <th>Presión atm máx</th>
      <th>Presión atm mín</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>43846.000000</td>
      <td>0.405810</td>
      <td>2.466192</td>
      <td>69.058465</td>
      <td>63.176194</td>
      <td>21.921264</td>
      <td>20.684570</td>
      <td>66.146682</td>
      <td>887.251925</td>
      <td>0.160907</td>
      <td>5.161076</td>
      <td>887.580724</td>
      <td>886.891093</td>
    </tr>
    <tr>
      <th>std</th>
      <td>25314.932915</td>
      <td>0.686247</td>
      <td>1.313968</td>
      <td>19.640222</td>
      <td>20.166336</td>
      <td>3.721386</td>
      <td>3.513744</td>
      <td>19.992327</td>
      <td>4.012404</td>
      <td>1.307515</td>
      <td>2.311157</td>
      <td>3.646750</td>
      <td>3.564539</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>-1.000000</td>
      <td>0.000000</td>
      <td>12.000000</td>
      <td>10.000000</td>
      <td>9.200000</td>
      <td>8.400000</td>
      <td>10.000000</td>
      <td>863.400000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>865.300000</td>
      <td>862.800000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>21923.000000</td>
      <td>-0.156434</td>
      <td>1.500000</td>
      <td>54.000000</td>
      <td>48.000000</td>
      <td>19.200000</td>
      <td>18.400000</td>
      <td>51.000000</td>
      <td>885.300000</td>
      <td>0.000000</td>
      <td>3.400000</td>
      <td>885.600000</td>
      <td>885.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>43846.000000</td>
      <td>0.788011</td>
      <td>2.400000</td>
      <td>72.000000</td>
      <td>64.000000</td>
      <td>21.400000</td>
      <td>20.200000</td>
      <td>68.000000</td>
      <td>887.200000</td>
      <td>0.000000</td>
      <td>5.000000</td>
      <td>887.500000</td>
      <td>886.900000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>65769.000000</td>
      <td>0.970296</td>
      <td>3.400000</td>
      <td>87.000000</td>
      <td>80.000000</td>
      <td>24.700000</td>
      <td>23.100000</td>
      <td>84.000000</td>
      <td>889.100000</td>
      <td>0.000000</td>
      <td>6.800000</td>
      <td>889.300000</td>
      <td>888.800000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>87692.000000</td>
      <td>1.000000</td>
      <td>10.000000</td>
      <td>100.000000</td>
      <td>98.000000</td>
      <td>35.300000</td>
      <td>34.400000</td>
      <td>99.000000</td>
      <td>1023.500000</td>
      <td>70.800000</td>
      <td>24.300000</td>
      <td>913.100000</td>
      <td>910.900000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Vemos que no encuentra ningun valor nulo en la serie, no es necesario realizar imputación de datos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_speed</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hora                   0
dir_viento             0
vel_viento             0
Humedad rel. máx       0
Humedad rel. mín.      0
Temp. máx              0
Temp mín.              0
Humedad rel horaria    0
Presión atm            0
Precip                 0
Máx ráfaga             0
Presión atm máx        0
Presión atm mín        0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">porcentaje_nulos</span> <span class="o">=</span> <span class="p">(</span><span class="n">wind_speed</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># &#39;porcentaje_nulos&#39; ahora contiene el porcentaje de valores nulos para cada columna</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Porcentaje de valores nulos&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">porcentaje_nulos</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Numero de datos faltantes&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wind_speed</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Porcentaje de valores nulos
Hora                   0.0
dir_viento             0.0
vel_viento             0.0
Humedad rel. máx       0.0
Humedad rel. mín.      0.0
Temp. máx              0.0
Temp mín.              0.0
Humedad rel horaria    0.0
Presión atm            0.0
Precip                 0.0
Máx ráfaga             0.0
Presión atm máx        0.0
Presión atm mín        0.0
dtype: float64

Numero de datos faltantes
Hora                   0
dir_viento             0
vel_viento             0
Humedad rel. máx       0
Humedad rel. mín.      0
Temp. máx              0
Temp mín.              0
Humedad rel horaria    0
Presión atm            0
Precip                 0
Máx ráfaga             0
Presión atm máx        0
Presión atm mín        0
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Como se observa no se encuentra ningun valor nulo en el dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">kurtosis</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="n">wind_speed</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Column: &#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skew:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Kurtosis: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">wind_speed</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wind_speed</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Hora
Skew: 0.0
Kurtosis:  -1.2
</pre></div>
</div>
<img alt="_images/a5532078201adf3234d10500ab707b0c4eafe2c82cbf4cfaed71f7bfc390acdd.png" src="_images/a5532078201adf3234d10500ab707b0c4eafe2c82cbf4cfaed71f7bfc390acdd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  dir_viento
Skew: -0.86
Kurtosis:  -0.82
</pre></div>
</div>
<img alt="_images/97902bb77f350a8c653c23ac5d40fbd028ee8c2118d2188c36b7ade01aa3bff0.png" src="_images/97902bb77f350a8c653c23ac5d40fbd028ee8c2118d2188c36b7ade01aa3bff0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  vel_viento
Skew: 0.37
Kurtosis:  -0.11
</pre></div>
</div>
<img alt="_images/1b188ac0654b12a7404608f2e8ed361ded8a97d98668fb71d75ac54e6060a2b0.png" src="_images/1b188ac0654b12a7404608f2e8ed361ded8a97d98668fb71d75ac54e6060a2b0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Humedad rel. máx
Skew: -0.48
Kurtosis:  -0.78
</pre></div>
</div>
<img alt="_images/bc5cbd4c0d360080859346f0a9ebed9bba76c65e51d32291e81b6362785d5c7b.png" src="_images/bc5cbd4c0d360080859346f0a9ebed9bba76c65e51d32291e81b6362785d5c7b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Humedad rel. mín.
Skew: -0.23
Kurtosis:  -0.96
</pre></div>
</div>
<img alt="_images/1bebe10057e992eae2d25586333b8ea113414bb10e628bfb1a7f3e350bf08f12.png" src="_images/1bebe10057e992eae2d25586333b8ea113414bb10e628bfb1a7f3e350bf08f12.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Temp. máx
Skew: 0.26
Kurtosis:  -0.42
</pre></div>
</div>
<img alt="_images/68c29e25550f21cc8660084ce81cdd431f1503f3d744839a4d07ed2c9499f61f.png" src="_images/68c29e25550f21cc8660084ce81cdd431f1503f3d744839a4d07ed2c9499f61f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Temp mín.
Skew: 0.24
Kurtosis:  -0.12
</pre></div>
</div>
<img alt="_images/b0037cd413ca4b3b7adec33bf7a6211314cd2bcc02a41adb2a6acf3499219faa.png" src="_images/b0037cd413ca4b3b7adec33bf7a6211314cd2bcc02a41adb2a6acf3499219faa.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Humedad rel horaria
Skew: -0.35
Kurtosis:  -0.89
</pre></div>
</div>
<img alt="_images/a99727cc8a01a194695880f8b7abdccdb796659d2e9c629fc39ab99f4875e391.png" src="_images/a99727cc8a01a194695880f8b7abdccdb796659d2e9c629fc39ab99f4875e391.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Presión atm
Skew: 6.18
Kurtosis:  179.64
</pre></div>
</div>
<img alt="_images/1177c57bc26a2053e37120168f74b9899cf49d0880004e9d13319c8fd0700773.png" src="_images/1177c57bc26a2053e37120168f74b9899cf49d0880004e9d13319c8fd0700773.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Precip
Skew: 17.65
Kurtosis:  476.4
</pre></div>
</div>
<img alt="_images/fc6ef8addbd2f92edd7122610e4af71e941401272d63ac4267f0285e6934a445.png" src="_images/fc6ef8addbd2f92edd7122610e4af71e941401272d63ac4267f0285e6934a445.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Máx ráfaga
Skew: 0.41
Kurtosis:  0.11
</pre></div>
</div>
<img alt="_images/b5a1bc638284ced2fd90f55b473e3f4ec1d6127bd5060e36017277497f15d28c.png" src="_images/b5a1bc638284ced2fd90f55b473e3f4ec1d6127bd5060e36017277497f15d28c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Presión atm máx
Skew: 1.02
Kurtosis:  5.82
</pre></div>
</div>
<img alt="_images/007e1fb3e7590fe9e4b1cf5c6d853d2434f69c512698f2195f07e267bb03713c.png" src="_images/007e1fb3e7590fe9e4b1cf5c6d853d2434f69c512698f2195f07e267bb03713c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Column:  Presión atm mín
Skew: 0.33
Kurtosis:  4.91
</pre></div>
</div>
<img alt="_images/691eed41acae2fbb7d6619f78a34558afc375f64ca8631e202e1a05f47401a77.png" src="_images/691eed41acae2fbb7d6619f78a34558afc375f64ca8631e202e1a05f47401a77.png" />
</div>
</div>
<ul class="simple">
<li><p>La Hora que es una variable continua tal como se espera tiene una distribución uniforme.</p></li>
<li><p>Se observa que la  dirección del viento tiene un sesgo hacia la derecha.</p></li>
<li><p>Mientras que la velocidad del viento, la variable a predecir tiene un sesgo hacia la izquierda, con varios outlayer en el margen superior. Al igual que la varible rafaga de viento.</p></li>
<li><p>Tanto la presion atmosferica maxima como minima tienen una distribucion casi simetrica.</p></li>
<li><p>En la precipitacion nos encontramos con una distribucion con un fuerte sesgo.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">wind_speed</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
            <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">},</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/843543f21f97cf4705966f75571b8d817f177975cf26001b32ad4a648efe794a.png" src="_images/843543f21f97cf4705966f75571b8d817f177975cf26001b32ad4a648efe794a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_wind</span> <span class="o">=</span> <span class="n">wind_speed</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;vel_viento&#39;</span><span class="p">)</span> <span class="c1"># Reemplaza con tus nombres de columna</span>

<span class="n">columnas</span> <span class="o">=</span> <span class="n">X_wind</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se aplica la funcion VIF para eliminar las variables independientes que tienen un numero mayor a 5 y asi mejorar el modelo y evitar multicolinealidad.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">vif_c</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columnas</span><span class="p">):</span>
    <span class="n">vif1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">vif1</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columnas</span>
    <span class="n">vif1</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">return</span> <span class="n">vif1</span>

<span class="n">contador</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">while</span> <span class="n">contador</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">vif1</span> <span class="o">=</span> <span class="n">vif_c</span><span class="p">(</span><span class="n">X_wind</span><span class="p">,</span> <span class="n">columnas</span><span class="p">)</span>
    <span class="n">indice_max_vif</span> <span class="o">=</span> <span class="n">vif1</span><span class="p">[</span><span class="s1">&#39;VIF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
    
    <span class="c1"># Elimina la columna con el VIF máximo en X_wind</span>
    <span class="n">X_wind</span> <span class="o">=</span> <span class="n">X_wind</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columnas</span><span class="p">[</span><span class="n">indice_max_vif</span><span class="p">])</span>
    
    <span class="c1"># Actualiza la lista de columnas</span>
    <span class="n">columnas</span> <span class="o">=</span> <span class="n">X_wind</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="n">contador</span> <span class="o">=</span> <span class="n">vif1</span><span class="p">[</span><span class="s1">&#39;VIF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se observa que las variables independientes restantes tienen un VIF MENOR A 5.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vif1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Variable</th>
      <th>VIF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Hora</td>
      <td>3.642504</td>
    </tr>
    <tr>
      <th>1</th>
      <td>dir_viento</td>
      <td>1.391809</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Humedad rel. mín.</td>
      <td>4.335346</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Precip</td>
      <td>1.041362</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Máx ráfaga</td>
      <td>4.045375</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_merge</span> <span class="o">=</span> <span class="n">X_wind</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">[[</span><span class="s1">&#39;vel_viento&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Efectivamente podemos observar que las variables independientes no se encuentran correlacionadas y tenemos un modelo mas sencillo.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">X_wind</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
            <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">},</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/53b538cab29fd8baeeca67efc6a9842611e6c99f1beec998232e372bc4d38427.png" src="_images/53b538cab29fd8baeeca67efc6a9842611e6c99f1beec998232e372bc4d38427.png" />
</div>
</div>
<section id="analisis-bivariado">
<h3>Analisis bivariado<a class="headerlink" href="#analisis-bivariado" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Se reliza un  scatterplot() y regplot(), para evaluar la relación de las variable a predecir “vel_viento” con las variables independientes que sobrevivieron al filtro de VIF, y entre todas las variables.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">wind_merge</span><span class="p">);</span>

<span class="n">num_cols</span> <span class="o">=</span> <span class="n">wind_merge</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">scatter_regplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">strx</span><span class="p">,</span> <span class="n">stry</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">strx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">stry</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">strx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">stry</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Relación entre </span><span class="si">%s</span><span class="s1"> y vel_viento&#39;</span><span class="o">%</span><span class="k">col</span>)  

<span class="n">num_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;vel_viento&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">num_cols</span><span class="p">:</span>
    <span class="n">scatter_regplot</span><span class="p">(</span><span class="n">wind_merge</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="s1">&#39;vel_viento&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1b99e33b9b284f942ef8745f9f60848b63b6d216fb481c43b45bef1bdb354a71.png" src="_images/1b99e33b9b284f942ef8745f9f60848b63b6d216fb481c43b45bef1bdb354a71.png" />
<img alt="_images/0c36187c75c00fefdd21314136d1b3300702b37ccf816ab58a5b7bbe3733cf85.png" src="_images/0c36187c75c00fefdd21314136d1b3300702b37ccf816ab58a5b7bbe3733cf85.png" />
<img alt="_images/0a0ef8a9cc655aa9ca35f121db7f9b5b7344cd52afc35a9e56d9361446ee1bab.png" src="_images/0a0ef8a9cc655aa9ca35f121db7f9b5b7344cd52afc35a9e56d9361446ee1bab.png" />
<img alt="_images/7a723c74d0723eee6d409ca6615817566969c2bbdfa32c5593bc804480833994.png" src="_images/7a723c74d0723eee6d409ca6615817566969c2bbdfa32c5593bc804480833994.png" />
<img alt="_images/97845eedac9b5919137dc9d67b8a4fc3351972938f4da66e43b9cbdec061c9d1.png" src="_images/97845eedac9b5919137dc9d67b8a4fc3351972938f4da66e43b9cbdec061c9d1.png" />
</div>
</div>
<p>Como se puedo observar no se apreciar una correlacion entre la hora y la direccion del viento con la velocidad del viento. Una relación no muy elevada entre la precip y la vel del viento. Por otro lado, Se aprecia una fuerte correlaccion entre la rafaga y la velocidad del viento.</p>
</section>
</section>
</section>
<section id="modelo-de-clasificacion">
<h1>Modelo de Clasificacion<a class="headerlink" href="#modelo-de-clasificacion" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span>
<span class="kn">import</span> <span class="nn">mglearn</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_fraud</span><span class="p">,</span> <span class="n">y_fraud</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_fraud</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Dado que es una serie desbalanceada como se pudo observar en el EDA, se usara StratifiedKFold que asegura que las proporciones de clases se mantengan en cada división de los datos</p></li>
<li><p>Por otro lado, dado que este es un problema de clasificación con clases desequilibradas, se utilizara el AUC para la selección del modelo que es más significativo que el uso de accuracy.</p></li>
</ul>
<ul class="simple">
<li><p>Se creara un dataframe para almacenar los resultados de los modelos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;Precision&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;Recall&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;F1-Score&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;AUC&#39;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>

<span class="n">clasificacion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc_score</span>

<span class="k">def</span> <span class="nf">metricas_class</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">,</span> <span class="n">nombre_modelo</span><span class="p">):</span>
    <span class="n">f1_sc</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">roc_auc_sc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">)</span>  <span class="c1"># Utiliza roc_auc_score para calcular el AUC-ROC</span>
    <span class="n">precision_sc</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">recall_sc</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="n">nombre_modelo</span><span class="p">,</span>
        <span class="s1">&#39;F1-Score&#39;</span><span class="p">:</span> <span class="n">f1_sc</span><span class="p">,</span>
        <span class="s1">&#39;AUC&#39;</span><span class="p">:</span> <span class="n">roc_auc_sc</span><span class="p">,</span>  
        <span class="s1">&#39;Precision&#39;</span><span class="p">:</span> <span class="n">precision_sc</span><span class="p">,</span>
        <span class="s1">&#39;Recall&#39;</span><span class="p">:</span> <span class="n">recall_sc</span>
    <span class="p">}</span>

    
</pre></div>
</div>
</div>
</div>
<section id="k-nn">
<h2>K-NN<a class="headerlink" href="#k-nn" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>


<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;kneighborsclassifier__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="p">]}</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">KNeighborsClassifier</span><span class="p">())</span> 

<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>

<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;kneighborsclassifier&#x27;,
                                        KNeighborsClassifier())]),
             n_jobs=-1,
             param_grid={&#x27;kneighborsclassifier__n_neighbors&#x27;: [1, 2, 4, 6, 8,
                                                               10, 12, 14]},
             scoring=&#x27;roc_auc&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;kneighborsclassifier&#x27;,
                                        KNeighborsClassifier())]),
             n_jobs=-1,
             param_grid={&#x27;kneighborsclassifier__n_neighbors&#x27;: [1, 2, 4, 6, 8,
                                                               10, 12, 14]},
             scoring=&#x27;roc_auc&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;kneighborsclassifier&#x27;, KNeighborsClassifier())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">KNeighborsClassifier</label><div class="sk-toggleable__content"><pre>KNeighborsClassifier()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;kneighborsclassifier&#39;, KNeighborsClassifier(n_neighbors=14))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="n">metricas_class</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">,</span> <span class="s1">&#39;k-NN&#39;</span><span class="p">)</span>

<span class="n">clasificacion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clasificacion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exception in thread Thread-6:
Traceback (most recent call last):
  File &quot;c:\Users\Rirub\miniconda3\envs\ml_venv\lib\threading.py&quot;, line 980, in _bootstrap_inner
    self.run()
  File &quot;c:\Users\Rirub\miniconda3\envs\ml_venv\lib\threading.py&quot;, line 917, in run
    self._target(*self._args, **self._kwargs)
  File &quot;c:\Users\Rirub\miniconda3\envs\ml_venv\lib\subprocess.py&quot;, line 1495, in _readerthread
    buffer.append(fh.read())
  File &quot;c:\Users\Rirub\miniconda3\envs\ml_venv\lib\codecs.py&quot;, line 322, in decode
    (result, consumed) = self._buffer_decode(data, self.errors, final)
UnicodeDecodeError: &#39;utf-8&#39; codec can&#39;t decode byte 0xa0 in position 16: invalid start byte
  File &quot;c:\Users\Rirub\miniconda3\envs\ml_venv\lib\site-packages\joblib\externals\loky\backend\context.py&quot;, line 282, in _count_physical_cores
    raise ValueError(f&quot;found {cpu_count_physical} physical cores &lt; 1&quot;)
</pre></div>
</div>
</div>
</div>
<section id="matriz-de-confusion-curva-roc">
<h3>Matriz de Confusión, Curva ROC<a class="headerlink" href="#matriz-de-confusion-curva-roc" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion matrix:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>

<span class="n">scores_image</span> <span class="o">=</span> <span class="n">mglearn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> 
                                     <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">,</span>
                                     <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True label&#39;</span><span class="p">,</span> 
                                     <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span>
                                     <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span> 
                                     <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span><span class="p">,</span> 
                                     <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix:
[[24343    17]
 [  555    85]]
</pre></div>
</div>
<img alt="_images/9acd73bf03681d7d63d4dd4ff1aec8aac7f479abebb52aa78262378868e89a6b.png" src="_images/9acd73bf03681d7d63d4dd4ff1aec8aac7f479abebb52aa78262378868e89a6b.png" />
</div>
</div>
<ul class="simple">
<li><p>Curva ROC</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ROC Curve&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;FPR&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;TPR (recall)&quot;</span><span class="p">)</span>
<span class="n">close_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">thresholds</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0fa056c7729940310e63b90e6362046903fe66a87f903cbbb99d5f262875bb29.png" src="_images/0fa056c7729940310e63b90e6362046903fe66a87f903cbbb99d5f262875bb29.png" />
</div>
</div>
<ul class="simple">
<li><p>La curva ROC no es la mas adecuada, a pesar de obtenerse una precision del 83%, el recall fue muy bajo, mostrando el problema de que la serie sea desbalanceada.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clasificacion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>Precision</th>
      <th>Recall</th>
      <th>F1-Score</th>
      <th>AUC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>0.833333</td>
      <td>0.132812</td>
      <td>0.229111</td>
      <td>0.814955</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="logisticregression">
<h2>LogisticRegression<a class="headerlink" href="#logisticregression" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>


<span class="c1"># Definir el espacio de búsqueda de hiperparámetros para Logistic Regression</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logisticregression__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>

<span class="c1"># Crear una tubería (pipeline) con StandardScaler y Logistic Regression</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">LogisticRegression</span><span class="p">())</span>

<span class="c1"># Utilizar validación cruzada estratificada</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>

<span class="c1"># Ajustar el modelo Logistic Regression con búsqueda de hiperparámetros</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;logisticregression&#x27;,
                                        LogisticRegression())]),
             n_jobs=-1,
             param_grid={&#x27;logisticregression__C&#x27;: [0.001, 0.01, 0.1, 1, 10,
                                                   100]},
             scoring=&#x27;roc_auc&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;logisticregression&#x27;,
                                        LogisticRegression())]),
             n_jobs=-1,
             param_grid={&#x27;logisticregression__C&#x27;: [0.001, 0.01, 0.1, 1, 10,
                                                   100]},
             scoring=&#x27;roc_auc&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;logisticregression&#x27;, LogisticRegression())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;logisticregression&#39;, LogisticRegression(C=0.1))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="n">metricas_class</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">,</span> <span class="s1">&#39;LogisticRegression&#39;</span><span class="p">)</span>

<span class="n">clasificacion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clasificacion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>Matriz de Confusión, Curva ROC<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion matrix:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>

<span class="n">scores_image</span> <span class="o">=</span> <span class="n">mglearn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> 
                                     <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">,</span>
                                     <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True label&#39;</span><span class="p">,</span> 
                                     <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span>
                                     <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span> 
                                     <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span><span class="p">,</span> 
                                     <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix:
[[24337    23]
 [  614    26]]
</pre></div>
</div>
<img alt="_images/6ddea3d1547e6cc6d9e18289414ec547f5836f52ec052bfaba0fad370860ab51.png" src="_images/6ddea3d1547e6cc6d9e18289414ec547f5836f52ec052bfaba0fad370860ab51.png" />
</div>
</div>
<ul class="simple">
<li><p>Curva ROC</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ROC Curve&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;FPR&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;TPR (recall)&quot;</span><span class="p">)</span>
<span class="n">close_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">thresholds</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/74c4990a4e772c36c41ca31f083958fe1b233abcae2f4df97ffbbf5dedf8c863.png" src="_images/74c4990a4e772c36c41ca31f083958fe1b233abcae2f4df97ffbbf5dedf8c863.png" />
</div>
</div>
<ul class="simple">
<li><p>Con este modelo obtenemos una curva ROC similar a k-NN, pero con un recall y F1 score aun peor, mostrando que no es modelo adecuado.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clasificacion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>Precision</th>
      <th>Recall</th>
      <th>F1-Score</th>
      <th>AUC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>0.833333</td>
      <td>0.132812</td>
      <td>0.229111</td>
      <td>0.814955</td>
    </tr>
    <tr>
      <th>1</th>
      <td>LogisticRegression</td>
      <td>0.530612</td>
      <td>0.040625</td>
      <td>0.075472</td>
      <td>0.806852</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="naive-bayes">
<h2>Naive Bayes<a class="headerlink" href="#naive-bayes" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">BernoulliNB</span>  <span class="c1"># Importa BernoulliNB en lugar de GaussianNB</span>


<span class="c1"># Crear una tubería (pipeline) con StandardScaler() y BernoulliNB()</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">BernoulliNB</span><span class="p">())</span>

<span class="c1"># Definir el espacio de búsqueda de hiperparámetros para BernoulliNB</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bernoullinb__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>

<span class="c1"># Utilizar validación cruzada estratificada</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>

<span class="c1"># Ajustar el modelo BernoulliNB con búsqueda de hiperparámetros</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-3 {color: black;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;bernoullinb&#x27;, BernoulliNB())]),
             n_jobs=-1,
             param_grid={&#x27;bernoullinb__alpha&#x27;: [0.01, 0.1, 1, 10, 100]},
             scoring=&#x27;roc_auc&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;bernoullinb&#x27;, BernoulliNB())]),
             n_jobs=-1,
             param_grid={&#x27;bernoullinb__alpha&#x27;: [0.01, 0.1, 1, 10, 100]},
             scoring=&#x27;roc_auc&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;bernoullinb&#x27;, BernoulliNB())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">BernoulliNB</label><div class="sk-toggleable__content"><pre>BernoulliNB()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;bernoullinb&#39;, BernoulliNB(alpha=0.01))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="n">metricas_class</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">,</span> <span class="s1">&#39;Naive Bayes&#39;</span><span class="p">)</span>

<span class="n">clasificacion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clasificacion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h3>Matriz de Confusión, Curva ROC<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion matrix:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>

<span class="n">scores_image</span> <span class="o">=</span> <span class="n">mglearn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> 
                                     <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">,</span>
                                     <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True label&#39;</span><span class="p">,</span> 
                                     <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span>
                                     <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span> 
                                     <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span><span class="p">,</span> 
                                     <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix:
[[22966  1394]
 [  438   202]]
</pre></div>
</div>
<img alt="_images/3ff21241ddf81bf01d10e54958131a3402b69c75ec400fdbd72943f7a2087b66.png" src="_images/3ff21241ddf81bf01d10e54958131a3402b69c75ec400fdbd72943f7a2087b66.png" />
</div>
</div>
<ul class="simple">
<li><p>Curva ROC</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ROC Curve&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;FPR&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;TPR (recall)&quot;</span><span class="p">)</span>
<span class="n">close_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">thresholds</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0e733f15bb016c745eb6284f6400ee7756d626b422a8a916a91faee9242596af.png" src="_images/0e733f15bb016c745eb6284f6400ee7756d626b422a8a916a91faee9242596af.png" />
</div>
</div>
<ul class="simple">
<li><p>Se obttiene una peor curva ROC pero aun asi un mejor Recall y F1-score que el modelo anterior.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clasificacion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>Precision</th>
      <th>Recall</th>
      <th>F1-Score</th>
      <th>AUC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>0.833333</td>
      <td>0.132812</td>
      <td>0.229111</td>
      <td>0.814955</td>
    </tr>
    <tr>
      <th>1</th>
      <td>LogisticRegression</td>
      <td>0.530612</td>
      <td>0.040625</td>
      <td>0.075472</td>
      <td>0.806852</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Naive Bayes</td>
      <td>0.126566</td>
      <td>0.315625</td>
      <td>0.180680</td>
      <td>0.779799</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="xgboost">
<h2>XGBoost<a class="headerlink" href="#xgboost" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="kn">from</span> <span class="nn">xgboost.sklearn</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>


<span class="c1"># Definir el espacio de búsqueda de hiperparámetros para XGBClassifier</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;xgbclassifier__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
    <span class="s1">&#39;xgbclassifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
    <span class="s1">&#39;xgbclassifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Crear un clasificador XGBClassifier</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">XGBClassifier</span><span class="p">())</span>

<span class="c1"># Utilizar validación cruzada estratificada</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>

<span class="c1"># Ajustar el modelo XGBClassifier con búsqueda de hiperparámetros</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-4 {color: black;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;xgbclassifier&#x27;,
                                        XGBClassifier(base_score=None,
                                                      booster=None,
                                                      callbacks=None,
                                                      colsample_bylevel=None,
                                                      colsample_bynode=None,
                                                      colsample_bytree=None,
                                                      device=None,
                                                      early_stopping_rounds=None,
                                                      enable_categorical=False,
                                                      eval_metric=N...
                                                      max_depth=None,
                                                      max_leaves=None,
                                                      min_child_weight=None,
                                                      missing=nan,
                                                      monotone_constraints=None,
                                                      multi_strategy=None,
                                                      n_estimators=None,
                                                      n_jobs=None,
                                                      num_parallel_tree=None,
                                                      random_state=None, ...))]),
             n_jobs=-1,
             param_grid={&#x27;xgbclassifier__learning_rate&#x27;: [0.01, 0.1, 0.2],
                         &#x27;xgbclassifier__max_depth&#x27;: [3, 4, 5],
                         &#x27;xgbclassifier__n_estimators&#x27;: [100, 200, 300]},
             scoring=&#x27;roc_auc&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;xgbclassifier&#x27;,
                                        XGBClassifier(base_score=None,
                                                      booster=None,
                                                      callbacks=None,
                                                      colsample_bylevel=None,
                                                      colsample_bynode=None,
                                                      colsample_bytree=None,
                                                      device=None,
                                                      early_stopping_rounds=None,
                                                      enable_categorical=False,
                                                      eval_metric=N...
                                                      max_depth=None,
                                                      max_leaves=None,
                                                      min_child_weight=None,
                                                      missing=nan,
                                                      monotone_constraints=None,
                                                      multi_strategy=None,
                                                      n_estimators=None,
                                                      n_jobs=None,
                                                      num_parallel_tree=None,
                                                      random_state=None, ...))]),
             n_jobs=-1,
             param_grid={&#x27;xgbclassifier__learning_rate&#x27;: [0.01, 0.1, 0.2],
                         &#x27;xgbclassifier__max_depth&#x27;: [3, 4, 5],
                         &#x27;xgbclassifier__n_estimators&#x27;: [100, 200, 300]},
             scoring=&#x27;roc_auc&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                (&#x27;xgbclassifier&#x27;,
                 XGBClassifier(base_score=None, booster=None, callbacks=None,
                               colsample_bylevel=None, colsample_bynode=None,
                               colsample_bytree=None, device=None,
                               early_stopping_rounds=None,
                               enable_categorical=False, eval_metric=None,
                               feature_types=None, gamma=None, grow_policy=None,
                               importance_type=None,
                               interaction_constraints=None, learning_rate=None,
                               max_bin=None, max_cat_threshold=None,
                               max_cat_to_onehot=None, max_delta_step=None,
                               max_depth=None, max_leaves=None,
                               min_child_weight=None, missing=nan,
                               monotone_constraints=None, multi_strategy=None,
                               n_estimators=None, n_jobs=None,
                               num_parallel_tree=None, random_state=None, ...))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">MinMaxScaler</label><div class="sk-toggleable__content"><pre>MinMaxScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label sk-toggleable__label-arrow">XGBClassifier</label><div class="sk-toggleable__content"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=None, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=None, n_jobs=None,
              num_parallel_tree=None, random_state=None, ...)</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                (&#39;xgbclassifier&#39;,
                 XGBClassifier(base_score=None, booster=None, callbacks=None,
                               colsample_bylevel=None, colsample_bynode=None,
                               colsample_bytree=None, device=None,
                               early_stopping_rounds=None,
                               enable_categorical=False, eval_metric=None,
                               feature_types=None, gamma=None, grow_policy=None,
                               importance_type=None,
                               interaction_constraints=None, learning_rate=0.2,
                               max_bin=None, max_cat_threshold=None,
                               max_cat_to_onehot=None, max_delta_step=None,
                               max_depth=5, max_leaves=None,
                               min_child_weight=None, missing=nan,
                               monotone_constraints=None, multi_strategy=None,
                               n_estimators=300, n_jobs=None,
                               num_parallel_tree=None, random_state=None, ...))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="n">metricas_class</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">,</span> <span class="s1">&#39;XGBoost&#39;</span><span class="p">)</span>

<span class="n">clasificacion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clasificacion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h3>Matriz de Confusión, Curva ROC<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion matrix:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>

<span class="n">scores_image</span> <span class="o">=</span> <span class="n">mglearn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> 
                                     <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">,</span>
                                     <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True label&#39;</span><span class="p">,</span> 
                                     <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span>
                                     <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span> 
                                     <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span><span class="p">,</span> 
                                     <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix:
[[24341    19]
 [  397   243]]
</pre></div>
</div>
<img alt="_images/61cb142b8645e090e581d2ba199211ced05cd63c3a64b9a887a7ff8918a9b65a.png" src="_images/61cb142b8645e090e581d2ba199211ced05cd63c3a64b9a887a7ff8918a9b65a.png" />
</div>
</div>
<ul class="simple">
<li><p>Curva ROC</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[9.9907780e-01, 9.2222414e-04],
       [9.9924445e-01, 7.5553486e-04],
       [9.9510640e-01, 4.8936210e-03],
       ...,
       [9.9502039e-01, 4.9796179e-03],
       [9.9777943e-01, 2.2205622e-03],
       [9.7226620e-01, 2.7733780e-02]], dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ROC Curve&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;FPR&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;TPR (recall)&quot;</span><span class="p">)</span>
<span class="n">close_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">thresholds</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/69ae6099c7b521711736730fc8940db39d592ab299211bbe3ead14730988b3ba.png" src="_images/69ae6099c7b521711736730fc8940db39d592ab299211bbe3ead14730988b3ba.png" />
</div>
</div>
<ul class="simple">
<li><p>Este modelo de Arboles de decisión demuestra un rendimiento superior a los anteriores modelos con todos los indicadores elevados y una curva ROC cercana a 1, vemos que podemos tener un recall alto con un FPR relativamente pequeño.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clasificacion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>Precision</th>
      <th>Recall</th>
      <th>F1-Score</th>
      <th>AUC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>0.833333</td>
      <td>0.132812</td>
      <td>0.229111</td>
      <td>0.814955</td>
    </tr>
    <tr>
      <th>1</th>
      <td>LogisticRegression</td>
      <td>0.530612</td>
      <td>0.040625</td>
      <td>0.075472</td>
      <td>0.806852</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Naive Bayes</td>
      <td>0.126566</td>
      <td>0.315625</td>
      <td>0.180680</td>
      <td>0.779799</td>
    </tr>
    <tr>
      <th>3</th>
      <td>XGBoost</td>
      <td>0.927481</td>
      <td>0.379688</td>
      <td>0.538803</td>
      <td>0.909898</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="svm">
<h2>SVM<a class="headerlink" href="#svm" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;svc__kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;rbf&#39;</span><span class="p">],</span>
               <span class="s1">&#39;svc__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
               <span class="s1">&#39;svc__gamma&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]}]</span>

<span class="sd">&quot;&quot;&quot;param_grid = [{&#39;svc__kernel&#39;: [&#39;linear&#39;],</span>
<span class="sd">               &#39;svc__gamma&#39;: [0.00001, 0.0001, 0.001, 0.01, 0.1]}]&quot;&quot;&quot;</span>


<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">())</span>


<span class="c1"># Utilizar validación cruzada estratificada</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>

<span class="c1"># Ajustar el modelo con búsqueda de hiperparámetros</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-7 {color: black;}#sk-container-id-7 pre{padding: 0;}#sk-container-id-7 div.sk-toggleable {background-color: white;}#sk-container-id-7 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-7 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-7 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-7 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-7 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-7 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-7 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-7 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-7 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-7 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-7 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-7 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-7 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-7 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-7 div.sk-item {position: relative;z-index: 1;}#sk-container-id-7 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-7 div.sk-item::before, #sk-container-id-7 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-7 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-7 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-7 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-7 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-7 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-7 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-7 div.sk-label-container {text-align: center;}#sk-container-id-7 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-7 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-7" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;svc&#x27;, SVC())]),
             n_jobs=-1,
             param_grid=[{&#x27;svc__C&#x27;: [0.001, 0.01, 0.1, 1, 10],
                          &#x27;svc__gamma&#x27;: [0.001, 0.01, 0.1, 1, 10],
                          &#x27;svc__kernel&#x27;: [&#x27;rbf&#x27;]}],
             scoring=&#x27;roc_auc&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-25" type="checkbox" ><label for="sk-estimator-id-25" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;svc&#x27;, SVC())]),
             n_jobs=-1,
             param_grid=[{&#x27;svc__C&#x27;: [0.001, 0.01, 0.1, 1, 10],
                          &#x27;svc__gamma&#x27;: [0.001, 0.01, 0.1, 1, 10],
                          &#x27;svc__kernel&#x27;: [&#x27;rbf&#x27;]}],
             scoring=&#x27;roc_auc&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-26" type="checkbox" ><label for="sk-estimator-id-26" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()), (&#x27;svc&#x27;, SVC())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-27" type="checkbox" ><label for="sk-estimator-id-27" class="sk-toggleable__label sk-toggleable__label-arrow">MinMaxScaler</label><div class="sk-toggleable__content"><pre>MinMaxScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox" ><label for="sk-estimator-id-28" class="sk-toggleable__label sk-toggleable__label-arrow">SVC</label><div class="sk-toggleable__content"><pre>SVC()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()), (&#39;svc&#39;, SVC(C=10, gamma=1))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="n">metricas_class</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">,</span> <span class="s1">&#39;SVM&#39;</span><span class="p">)</span>

<span class="n">clasificacion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clasificacion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id4">
<h3>Matriz de Confusión, Curva ROC<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion matrix:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>

<span class="n">scores_image</span> <span class="o">=</span> <span class="n">mglearn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> 
                                     <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">,</span>
                                     <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True label&#39;</span><span class="p">,</span> 
                                     <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span>
                                     <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span> 
                                     <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span><span class="p">,</span> 
                                     <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix:
[[24335    25]
 [  529   111]]
</pre></div>
</div>
<img alt="_images/bcefab5656ea3bde0f546b66b547d44310ccb53ae6cdf2900d3d71dca9c072f2.png" src="_images/bcefab5656ea3bde0f546b66b547d44310ccb53ae6cdf2900d3d71dca9c072f2.png" />
</div>
</div>
<ul class="simple">
<li><p>Curva ROC</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ROC Curve&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;FPR&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;TPR (recall)&quot;</span><span class="p">)</span>
<span class="n">close_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">thresholds</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/75e8aed221b67607a53deea0da1bdd4388fc603c30429cf64d5279b4c10f8a2b.png" src="_images/75e8aed221b67607a53deea0da1bdd4388fc603c30429cf64d5279b4c10f8a2b.png" />
</div>
</div>
<ul class="simple">
<li><p>SVM muestra un peor rendimiento que el modelo anterior, quizas con un “C” mas alto se obtendria un mejor rendimiento pero por motivos computacionales este fue el rango de tuning utilizado. La curva ROC tiene un comportamiento similar, es necesario una mayor Tasa de Falsos Positivos para que aumente el recall, a la del modelo k-NN.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clasificacion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>Precision</th>
      <th>Recall</th>
      <th>F1-Score</th>
      <th>AUC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>0.833333</td>
      <td>0.132812</td>
      <td>0.229111</td>
      <td>0.814955</td>
    </tr>
    <tr>
      <th>1</th>
      <td>LogisticRegression</td>
      <td>0.530612</td>
      <td>0.040625</td>
      <td>0.075472</td>
      <td>0.806852</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Naive Bayes</td>
      <td>0.126566</td>
      <td>0.315625</td>
      <td>0.180680</td>
      <td>0.779799</td>
    </tr>
    <tr>
      <th>3</th>
      <td>XGBoost</td>
      <td>0.927481</td>
      <td>0.379688</td>
      <td>0.538803</td>
      <td>0.909898</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SVM</td>
      <td>0.816176</td>
      <td>0.173437</td>
      <td>0.286082</td>
      <td>0.819242</td>
    </tr>
    <tr>
      <th>6</th>
      <td>MLP</td>
      <td>0.914591</td>
      <td>0.401562</td>
      <td>0.558089</td>
      <td>0.940276</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="mlp">
<h2>MLP<a class="headerlink" href="#mlp" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>


<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;mlpclassifier__hidden_layer_sizes&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">50</span><span class="p">,),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,),</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)],</span>
    <span class="s1">&#39;mlpclassifier__activation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;tanh&#39;</span><span class="p">],</span>
    <span class="s1">&#39;mlpclassifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Crear un modelo MLPClassifier</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">MLPClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>

<span class="c1"># Crear un objeto GridSearchCV para buscar hiperparámetros</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>

<span class="c1"># Ajustar el modelo y buscar la mejor combinación de hiperparámetros</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_fraud</span><span class="p">,</span> <span class="n">y_fraud</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-6 {color: black;}#sk-container-id-6 pre{padding: 0;}#sk-container-id-6 div.sk-toggleable {background-color: white;}#sk-container-id-6 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-6 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-6 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-6 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-6 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-6 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-6 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-6 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-6 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-6 div.sk-item {position: relative;z-index: 1;}#sk-container-id-6 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-6 div.sk-item::before, #sk-container-id-6 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-6 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-6 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-6 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-6 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-6 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-6 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-6 div.sk-label-container {text-align: center;}#sk-container-id-6 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-6 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;mlpclassifier&#x27;,
                                        MLPClassifier(random_state=42))]),
             n_jobs=-1,
             param_grid={&#x27;mlpclassifier__activation&#x27;: [&#x27;relu&#x27;, &#x27;tanh&#x27;],
                         &#x27;mlpclassifier__alpha&#x27;: [0.0001, 0.001, 0.01, 0.1],
                         &#x27;mlpclassifier__hidden_layer_sizes&#x27;: [(50,), (100,),
                                                               (50, 50)]},
             scoring=&#x27;roc_auc&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;mlpclassifier&#x27;,
                                        MLPClassifier(random_state=42))]),
             n_jobs=-1,
             param_grid={&#x27;mlpclassifier__activation&#x27;: [&#x27;relu&#x27;, &#x27;tanh&#x27;],
                         &#x27;mlpclassifier__alpha&#x27;: [0.0001, 0.001, 0.01, 0.1],
                         &#x27;mlpclassifier__hidden_layer_sizes&#x27;: [(50,), (100,),
                                                               (50, 50)]},
             scoring=&#x27;roc_auc&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                (&#x27;mlpclassifier&#x27;, MLPClassifier(random_state=42))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox" ><label for="sk-estimator-id-23" class="sk-toggleable__label sk-toggleable__label-arrow">MinMaxScaler</label><div class="sk-toggleable__content"><pre>MinMaxScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-24" type="checkbox" ><label for="sk-estimator-id-24" class="sk-toggleable__label sk-toggleable__label-arrow">MLPClassifier</label><div class="sk-toggleable__content"><pre>MLPClassifier(random_state=42)</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                (&#39;mlpclassifier&#39;, MLPClassifier(random_state=42))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="n">metricas_class</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span><span class="p">,</span><span class="s1">&#39;MLP&#39;</span><span class="p">)</span>

<span class="n">clasificacion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">clasificacion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id5">
<h3>Matriz de Confusión, Curva ROC<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion matrix:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>

<span class="n">scores_image</span> <span class="o">=</span> <span class="n">mglearn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> 
                                     <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">,</span>
                                     <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True label&#39;</span><span class="p">,</span> 
                                     <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span>
                                     <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No Fraude&#39;</span><span class="p">,</span><span class="s1">&#39;Fraude&#39;</span><span class="p">],</span> 
                                     <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray_r</span><span class="p">,</span> 
                                     <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Confusion matrix:
[[24336    24]
 [  383   257]]
</pre></div>
</div>
<img alt="_images/54cd1f6ee3900b8e6d9dacf18f24770107803c8e055140c1bc493f1b45ca9b17.png" src="_images/54cd1f6ee3900b8e6d9dacf18f24770107803c8e055140c1bc493f1b45ca9b17.png" />
</div>
</div>
<ul class="simple">
<li><p>Curva ROC</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ROC Curve&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;FPR&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;TPR (recall)&quot;</span><span class="p">)</span>
<span class="n">close_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">thresholds</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/25a95618da6ee7d05a56490676677e4f32f8ff61777810aeb0613edc227eae2c.png" src="_images/25a95618da6ee7d05a56490676677e4f32f8ff61777810aeb0613edc227eae2c.png" />
</div>
</div>
<ul class="simple">
<li><p>Se observa que la curva ROC se acerca bastante a ser un rectangulo que es el objetivo, obteniendo la mejor curva de los modelos utilizados, bastante cercana al objetivo que es 1.</p></li>
</ul>
</section>
</section>
<section id="resultados-del-modelo-de-clasificacion">
<h2>Resultados del Modelo de clasificación<a class="headerlink" href="#resultados-del-modelo-de-clasificacion" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Observamos que el mejor resultado se obtuvo con MLP para todos los parametros excepto precision, pero como es una clase desbalanceada no nos interesa en gran medida, seguido de XGBoost y posteriormente SVM. El modelo que dio el peor resultado fue Naive Bayes para el parametro a maximizar que era el AUC.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clasificacion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>Precision</th>
      <th>Recall</th>
      <th>F1-Score</th>
      <th>AUC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>0.833333</td>
      <td>0.132812</td>
      <td>0.229111</td>
      <td>0.814955</td>
    </tr>
    <tr>
      <th>1</th>
      <td>LogisticRegression</td>
      <td>0.530612</td>
      <td>0.040625</td>
      <td>0.075472</td>
      <td>0.806852</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Naive Bayes</td>
      <td>0.126566</td>
      <td>0.315625</td>
      <td>0.180680</td>
      <td>0.779799</td>
    </tr>
    <tr>
      <th>3</th>
      <td>XGBoost</td>
      <td>0.927481</td>
      <td>0.379688</td>
      <td>0.538803</td>
      <td>0.909898</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SVM</td>
      <td>0.816176</td>
      <td>0.173437</td>
      <td>0.286082</td>
      <td>0.819242</td>
    </tr>
    <tr>
      <th>6</th>
      <td>MLP</td>
      <td>0.914591</td>
      <td>0.401562</td>
      <td>0.558089</td>
      <td>0.940276</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="modelo-de-regresion">
<h1>Modelo de regresion<a class="headerlink" href="#modelo-de-regresion" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>Se importan las librerias necesarias para el problema de regresión</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se reducira el conjunto de entrenamiento para poder realizar el entrenamiento.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_wind</span> <span class="o">=</span> <span class="n">X_wind</span>
<span class="n">y_wind</span> <span class="o">=</span> <span class="n">wind_speed</span><span class="p">[[</span><span class="s1">&#39;vel_viento&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_wind_c</span> <span class="o">=</span> <span class="n">X_wind</span>
<span class="n">y_wind_c</span> <span class="o">=</span> <span class="n">y_wind</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular la mitad del número de filas (redondeando hacia arriba)</span>
<span class="n">mitad</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_wind</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_wind</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>

<span class="c1"># Seleccionar la primera mitad de filas</span>
<span class="n">X_wind</span> <span class="o">=</span> <span class="n">X_wind</span><span class="p">[:</span><span class="n">mitad</span><span class="p">]</span>
<span class="n">y_wind</span> <span class="o">=</span> <span class="n">y_wind</span><span class="p">[:</span><span class="n">mitad</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">metrica</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="c1"># Calcular el RRMSE directamente</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">RMSE</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se separan los datos en test, que no se tocaran solo hasta el final para evaluar el modelo, y en datos de entrenamiento y validacion para comprobar que modelo es mejor.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_wind_test</span> <span class="o">=</span> <span class="n">y_wind</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="n">y_wind_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_wind_test</span><span class="p">)</span>
<span class="n">y_wind_trainval</span> <span class="o">=</span> <span class="n">y_wind</span><span class="p">[:</span><span class="o">-</span><span class="mi">24</span><span class="p">]</span>
<span class="n">X_wind_test</span> <span class="o">=</span> <span class="n">X_wind</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="n">X_wind_trainval</span> <span class="o">=</span> <span class="n">X_wind</span><span class="p">[:</span><span class="o">-</span><span class="mi">24</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se establece un dataframe donde se guardara los resultados de cada modelo</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Crear un DataFrame inicial con columnas</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;MAPE&#39;</span><span class="p">:[],</span>
        <span class="s1">&#39;RMSE&#39;</span><span class="p">:[],</span>
        <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="n">regresion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se establecera el numero de Folds</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#n_folds = int(len(y_wind_trainval) / (24))</span>

<span class="n">n_folds</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<section id="metricas">
<h2>Metricas<a class="headerlink" href="#metricas" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">metricas_completas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    
    <span class="c1"># 1. Calcula el error absoluto porcentual (APE)</span>
    <span class="n">APE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># 2. Calcula el MAPE promediando los APEs</span>
    <span class="n">MAPE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">APE</span><span class="p">)</span>
    
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
    
    <span class="c1"># Calcular R-squared</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="c1"># print(f&quot;R-squared (R^2): {r2:.2f}&quot;)</span>
    
    <span class="k">return</span> <span class="n">MAPE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">r2</span>
    
    
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h2>K-NN<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>En primer lugar se utilizo el modelo k-NN, tomando desde 3 a 23 vecinos cercanos para obtener cual era el numero optimo.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

<span class="c1"># Valores de hiperparámetros de k-NN</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span>  <span class="c1"># Número de vecinos</span>

<span class="p">}</span>

<span class="n">combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">param_grid</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>  <span class="c1"># Todas las combinaciones</span>

<span class="n">valores_rmse</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">combination</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
    <span class="n">rmse_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_folds</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="n">X_wind_train</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">y_wind_train</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">X_wind_val</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>
        <span class="n">y_wind_val</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>

        <span class="c1"># Crear un modelo k-NN con la combinación actual de hiperparámetros</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">param_grid</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">combination</span><span class="p">))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Estándarización</span>
            <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>  <span class="c1"># Modelo k-NN</span>
        <span class="p">])</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_train</span><span class="p">,</span> <span class="n">y_wind_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_val</span><span class="p">)</span>

        <span class="c1"># Calcular el RMSE para esta ventana</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">metrica</span><span class="p">(</span><span class="n">y_wind_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="n">rmse_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>

    <span class="c1"># Calcula la media de los RMSE de las particiones de validación cruzada</span>
    <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_list</span><span class="p">)</span>

    <span class="n">valores_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">params</span><span class="p">,</span> <span class="n">mean_rmse</span><span class="p">))</span>

<span class="c1"># Encuentra la combinación de hiperparámetros con el RMSE más bajo</span>
<span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">valores_rmse</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Crea el modelo k-NN con los mejores hiperparámetros</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Estándarización</span>
    <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">best_params</span><span class="p">))</span>  <span class="c1"># Modelo k-NN</span>
<span class="p">])</span>
<span class="n">best_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_trainval</span><span class="p">,</span> <span class="n">y_wind_trainval</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_test</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE, RMSE y R2 en el conjunto de prueba</span>
<span class="n">MAPE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">R2</span> <span class="o">=</span> <span class="n">metricas_completas</span><span class="p">(</span><span class="n">y_wind_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;k-NN&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">MAPE</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">RMSE</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">R2</span><span class="p">}</span>
<span class="n">regresion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">regresion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regresion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>17.261516</td>
      <td>0.834286</td>
      <td>0.685043</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="ridge">
<h2>Ridge<a class="headerlink" href="#ridge" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Para el modelo Ridge al igual que mas adelante con el modelo Lasso, se generaron 100 alphas para probar el mejor ajuste.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

<span class="n">n_alphas</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_alphas</span><span class="p">)</span>

<span class="c1"># Valores de hiperparámetros de Ridge</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alphas</span><span class="p">,</span>  <span class="c1"># Parámetro de regularización</span>
<span class="p">}</span>

<span class="n">combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">param_grid</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>  <span class="c1"># Todas las combinaciones</span>

<span class="n">valores_rmse</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">combination</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
    <span class="n">rmse_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_folds</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="n">X_wind_train</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">y_wind_train</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">X_wind_val</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>
        <span class="n">y_wind_val</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>

        <span class="c1"># Crear un modelo Ridge con la combinación actual de hiperparámetros</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">param_grid</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">combination</span><span class="p">))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Estándarización</span>
            <span class="p">(</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>  <span class="c1"># Modelo Ridge</span>
        <span class="p">])</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_train</span><span class="p">,</span> <span class="n">y_wind_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_val</span><span class="p">)</span>

        <span class="c1"># Calcular el RMSE para esta ventana</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">metrica</span><span class="p">(</span><span class="n">y_wind_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="n">rmse_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>

    <span class="c1"># Calcula la media de los RMSE de las particiones de validación cruzada</span>
    <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_list</span><span class="p">)</span>

    <span class="n">valores_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">params</span><span class="p">,</span> <span class="n">mean_rmse</span><span class="p">))</span>

<span class="c1"># Encuentra la combinación de hiperparámetros con el RMSE más bajo</span>
<span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">valores_rmse</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Crea el modelo Ridge con los mejores hiperparámetros</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Estándarización</span>
    <span class="p">(</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">(</span><span class="o">**</span><span class="n">best_params</span><span class="p">))</span>  <span class="c1"># Modelo Ridge</span>
<span class="p">])</span>
<span class="n">best_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_trainval</span><span class="p">,</span> <span class="n">y_wind_trainval</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_test</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE, RMSE y R2 en el conjunto de prueba</span>
<span class="n">MAPE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">R2</span> <span class="o">=</span> <span class="n">metricas_completas</span><span class="p">(</span><span class="n">y_wind_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;Ridge&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">MAPE</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">RMSE</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">R2</span><span class="p">}</span>
<span class="n">regresion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">regresion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regresion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>17.261516</td>
      <td>0.834286</td>
      <td>0.685043</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ridge</td>
      <td>17.924131</td>
      <td>0.665085</td>
      <td>0.799841</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="lasso">
<h2>Lasso<a class="headerlink" href="#lasso" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Igualmente se aplico el modelo Lasso, el cual puede llegar a reducir las variables hasta 0, si observa que no aportan al modelo. Para este caso se probaron 100 alphas.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>


<span class="n">n_alphas</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_alphas</span><span class="p">)</span>

<span class="c1"># Valores de hiperparámetros de Lasso</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alphas</span><span class="p">,</span>  <span class="c1"># Parámetro de regularización</span>
<span class="p">}</span>

<span class="n">combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">param_grid</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>  <span class="c1"># Todas las combinaciones</span>

<span class="n">valores_rmse</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">combination</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
    <span class="n">rmse_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_folds</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="n">X_wind_train</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">y_wind_train</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">X_wind_val</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>
        <span class="n">y_wind_val</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>

        <span class="c1"># Crear un modelo Lasso con la combinación actual de hiperparámetros</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">param_grid</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">combination</span><span class="p">))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Estándarización</span>
            <span class="p">(</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>  <span class="c1"># Modelo Lasso</span>
        <span class="p">])</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_train</span><span class="p">,</span> <span class="n">y_wind_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_val</span><span class="p">)</span>

        <span class="c1"># Calcular el RMSE para esta ventana</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">metrica</span><span class="p">(</span><span class="n">y_wind_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="n">rmse_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>

    <span class="c1"># Calcula la media de los RMSE de las particiones de validación cruzada</span>
    <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_list</span><span class="p">)</span>

    <span class="n">valores_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">params</span><span class="p">,</span> <span class="n">mean_rmse</span><span class="p">))</span>

<span class="c1"># Encuentra la combinación de hiperparámetros con el RMSE más bajo</span>
<span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">valores_rmse</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Crea el modelo Lasso con los mejores hiperparámetros</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Estándarización</span>
    <span class="p">(</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">(</span><span class="o">**</span><span class="n">best_params</span><span class="p">))</span>  <span class="c1"># Modelo Lasso</span>
<span class="p">])</span>
<span class="n">best_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_trainval</span><span class="p">,</span> <span class="n">y_wind_trainval</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_test</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE, RMSE y R2 en el conjunto de prueba</span>
<span class="n">MAPE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">R2</span> <span class="o">=</span> <span class="n">metricas_completas</span><span class="p">(</span><span class="n">y_wind_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;Lasso&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">MAPE</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">RMSE</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">R2</span><span class="p">}</span>
<span class="n">regresion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">regresion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>({&#39;alpha&#39;: 0.01}, 0.5741308738705226)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regresion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>17.261516</td>
      <td>0.834286</td>
      <td>0.685043</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ridge</td>
      <td>17.924131</td>
      <td>0.665085</td>
      <td>0.799841</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lasso</td>
      <td>49.622335</td>
      <td>0.652041</td>
      <td>0.807615</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id7">
<h2>XGBoost<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Para xgboost se utilizo su libreria independiente que actualmente es mas rapida, y se definieron algunos parametros de prepoda del arbol como el max_depth,  para encontrar el mejor ajuste.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>  <span class="c1"># Para generar todas las combinaciones</span>

<span class="c1"># Valores de hiperparámetros de XGBoost y alphas</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>  <span class="c1"># Agrega los valores de alphas que desees</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>      <span class="c1"># Número de árboles</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span>   <span class="c1"># Tasa de aprendizaje</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>            <span class="c1"># Profundidad máxima del árbol</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alphas</span>                  <span class="c1"># Parámetro de regularización L1</span>
<span class="p">}</span>

<span class="n">combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">param_grid</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>  <span class="c1"># Todas las combinaciones</span>

<span class="n">valores_rmse</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">combination</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
    <span class="n">rmse_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_folds</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="n">X_wind_train</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">y_wind_train</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">X_wind_val</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>
        <span class="n">y_wind_val</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>

        <span class="c1"># Crear un modelo XGBoost con la combinación actual de hiperparámetros</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">param_grid</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">combination</span><span class="p">))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Estándarización</span>
            <span class="p">(</span><span class="s1">&#39;xgb&#39;</span><span class="p">,</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>  <span class="c1"># Modelo XGBoost</span>
        <span class="p">])</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_train</span><span class="p">,</span> <span class="n">y_wind_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_val</span><span class="p">)</span>

        <span class="c1"># Calcular el RMSE para esta ventana</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">metrica</span><span class="p">(</span><span class="n">y_wind_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="n">rmse_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>


    <span class="c1"># Calcula la media de los RMSE de las particiones de validación cruzada</span>
    <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_list</span><span class="p">)</span>

    <span class="n">valores_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">params</span><span class="p">,</span> <span class="n">mean_rmse</span><span class="p">))</span>

<span class="c1"># Encuentra la combinación de hiperparámetros con el RMSE más bajo</span>
<span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">valores_rmse</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Crea el modelo XGBoost con los mejores hiperparámetros</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Estándarización</span>
    <span class="p">(</span><span class="s1">&#39;xgb&#39;</span><span class="p">,</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">best_params</span><span class="p">))</span>  <span class="c1"># Modelo XGBoost</span>
<span class="p">])</span>
<span class="n">best_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_trainval</span><span class="p">,</span> <span class="n">y_wind_trainval</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_test</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE, RMSE y R2 en el conjunto de prueba</span>
<span class="n">MAPE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">R2</span> <span class="o">=</span> <span class="n">metricas_completas</span><span class="p">(</span><span class="n">y_wind_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;XGBoost&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">MAPE</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">RMSE</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">R2</span><span class="p">}</span>
<span class="n">regresion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">regresion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>({&#39;n_estimators&#39;: 100, &#39;learning_rate&#39;: 0.1, &#39;max_depth&#39;: 3, &#39;alpha&#39;: 1.0},
 0.5888264285376953)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regresion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>17.261516</td>
      <td>0.834286</td>
      <td>0.685043</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ridge</td>
      <td>17.924131</td>
      <td>0.665085</td>
      <td>0.799841</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lasso</td>
      <td>49.622335</td>
      <td>0.652041</td>
      <td>0.807615</td>
    </tr>
    <tr>
      <th>3</th>
      <td>XGBoost</td>
      <td>45.679888</td>
      <td>0.782845</td>
      <td>0.722685</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="svr">
<h2>SVR<a class="headerlink" href="#svr" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Para el SVR se probo con dos kernel, el lineal y el rbf, para obtener los mejores ajustes de los hiperparametros.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

<span class="c1"># Valores de hiperparámetros de SVR</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span>          <span class="c1"># Parámetro de regularización</span>
    <span class="s1">&#39;epsilon&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">],</span>  <span class="c1"># Tolerancia de error</span>
    <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">]</span>     <span class="c1"># Tipo de kernel (lineal o RBF)</span>
<span class="p">}</span>

<span class="n">combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">param_grid</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>  <span class="c1"># Todas las combinaciones</span>

<span class="n">valores_rmse</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">combination</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
    <span class="n">rmse_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_folds</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="n">X_wind_train</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">y_wind_train</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">X_wind_val</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>
        <span class="n">y_wind_val</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>

        <span class="c1"># Crear un modelo SVR con la combinación actual de hiperparámetros</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">param_grid</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">combination</span><span class="p">))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>  <span class="c1"># Estandarización con MinMaxScaler</span>
            <span class="p">(</span><span class="s1">&#39;svr&#39;</span><span class="p">,</span> <span class="n">SVR</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>       <span class="c1"># Modelo SVR</span>
        <span class="p">])</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_train</span><span class="p">,</span> <span class="n">y_wind_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_val</span><span class="p">)</span>

        <span class="c1"># Calcular el RMSE para esta ventana</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">metrica</span><span class="p">(</span><span class="n">y_wind_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="n">rmse_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>


    <span class="c1"># Calcula la media de los RMSE de las particiones de validación cruzada</span>
    <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_list</span><span class="p">)</span>

    <span class="n">valores_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">params</span><span class="p">,</span> <span class="n">mean_rmse</span><span class="p">))</span>

<span class="c1"># Encuentra la combinación de hiperparámetros con el RMSE más bajo</span>
<span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">valores_rmse</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Crea el modelo SVR con los mejores hiperparámetros</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>  <span class="c1"># Estandarización con MinMaxScaler</span>
    <span class="p">(</span><span class="s1">&#39;svr&#39;</span><span class="p">,</span> <span class="n">SVR</span><span class="p">(</span><span class="o">**</span><span class="n">best_params</span><span class="p">))</span>  <span class="c1"># Modelo SVR</span>
<span class="p">])</span>
<span class="n">best_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_trainval</span><span class="p">,</span> <span class="n">y_wind_trainval</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_test</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE, RMSE y R2 en el conjunto de prueba</span>
<span class="n">MAPE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">R2</span> <span class="o">=</span> <span class="n">metricas_completas</span><span class="p">(</span><span class="n">y_wind_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;SVR&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">MAPE</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">RMSE</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">R2</span><span class="p">}</span>
<span class="n">regresion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">regresion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regresion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>17.261516</td>
      <td>0.834286</td>
      <td>0.685043</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ridge</td>
      <td>17.924131</td>
      <td>0.665085</td>
      <td>0.799841</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lasso</td>
      <td>49.622335</td>
      <td>0.652041</td>
      <td>0.807615</td>
    </tr>
    <tr>
      <th>3</th>
      <td>XGBoost</td>
      <td>45.679888</td>
      <td>0.782845</td>
      <td>0.722685</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SVR</td>
      <td>50.894473</td>
      <td>0.602933</td>
      <td>0.835502</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id8">
<h2>MLP<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Aqui se crea el EarlyStopping, el cual detendra el proceso de aprendizaje de la red neunoral cuando no mejore la perdida, Loss.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Finalmente para el metodo de MLP se establecio como 10 folds, y se toma el modelo que de un mejor RMSE, se hizo prueba de diferentes configuraciones de las hidden layer.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="c1"># Valores de hiperparámetros de MLP</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;hidden_layer_sizes&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">),</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">)],</span>
    <span class="s1">&#39;activation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;relu&#39;</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">param_grid</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="n">valores_rmse</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">combination</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">:</span>
    <span class="n">rmse_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_folds</span><span class="o">/</span><span class="mi">10</span><span class="p">)):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="n">X_wind_train</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">y_wind_train</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">X_wind_val</span> <span class="o">=</span> <span class="n">X_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>
        <span class="n">y_wind_val</span> <span class="o">=</span> <span class="n">y_wind_trainval</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">24</span><span class="p">]</span>

        <span class="c1"># Crear un modelo MLP con la combinación actual de hiperparámetros</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">param_grid</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">combination</span><span class="p">))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">X_wind_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],)),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;hidden_layer_sizes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;activation&#39;</span><span class="p">]),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;hidden_layer_sizes&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;activation&#39;</span><span class="p">]),</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;hidden_layer_sizes&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;activation&#39;</span><span class="p">]),</span>

            <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

        <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
        <span class="n">X_wind_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_wind_train</span><span class="p">)</span>
        <span class="n">X_wind_val_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_wind_val</span><span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_train_scaled</span><span class="p">,</span> <span class="n">y_wind_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>

        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_val_scaled</span><span class="p">)</span>
        <span class="n">rmse_value</span> <span class="o">=</span> <span class="n">metrica</span><span class="p">(</span><span class="n">y_wind_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">rmse_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse_value</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

    <span class="c1"># Calcula la media de los RMSE de las particiones de validación cruzada</span>
    <span class="n">mean_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_list</span><span class="p">)</span>
    <span class="n">valores_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">params</span><span class="p">,</span> <span class="n">mean_rmse</span><span class="p">))</span>

<span class="c1"># Encuentra la combinación de hiperparámetros con el RMSE más bajo</span>
<span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">valores_rmse</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Entrena el modelo MLP con los mejores hiperparámetros en todo el conjunto de entrenamiento</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">X_wind_trainval</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],)),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;hidden_layer_sizes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;activation&#39;</span><span class="p">]),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;hidden_layer_sizes&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;activation&#39;</span><span class="p">]),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;hidden_layer_sizes&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;activation&#39;</span><span class="p">]),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">best_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">X_wind_trainval_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_wind_trainval</span><span class="p">)</span>
<span class="n">X_wind_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_wind_test</span><span class="p">)</span>

<span class="n">best_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_wind_trainval_scaled</span><span class="p">,</span> <span class="n">y_wind_trainval</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>

<span class="c1"># Realiza predicciones en el conjunto de prueba</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_wind_test_scaled</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE, RMSE y R2 en el conjunto de prueba</span>
<span class="n">MAPE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">R2</span> <span class="o">=</span> <span class="n">metricas_completas</span><span class="p">(</span><span class="n">y_wind_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="n">nueva_fila</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;MLP&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">MAPE</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">RMSE</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">R2</span><span class="p">}</span>
<span class="n">regresion_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">regresion_modelos</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">nueva_fila</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - 0s 196ms/step
0
1/1 [==============================] - 0s 112ms/step
1
1/1 [==============================] - 0s 164ms/step
2
1/1 [==============================] - 0s 167ms/step
3
1/1 [==============================] - 0s 139ms/step
4
1/1 [==============================] - 0s 144ms/step
5
1/1 [==============================] - 0s 106ms/step
6
1/1 [==============================] - 0s 100ms/step
7
1/1 [==============================] - 0s 123ms/step
8
1/1 [==============================] - 0s 119ms/step
9
1/1 [==============================] - 0s 322ms/step
0
1/1 [==============================] - 0s 182ms/step
1
1/1 [==============================] - 0s 117ms/step
2
1/1 [==============================] - 0s 259ms/step
3
1/1 [==============================] - 0s 106ms/step
4
1/1 [==============================] - 0s 134ms/step
5
1/1 [==============================] - 0s 136ms/step
6
1/1 [==============================] - 0s 96ms/step
7
1/1 [==============================] - 0s 158ms/step
8
1/1 [==============================] - 0s 135ms/step
9
1/1 [==============================] - 0s 159ms/step
0
1/1 [==============================] - 0s 195ms/step
1
1/1 [==============================] - 0s 107ms/step
2
1/1 [==============================] - 0s 118ms/step
3
1/1 [==============================] - 0s 128ms/step
4
1/1 [==============================] - 0s 161ms/step
5
1/1 [==============================] - 0s 143ms/step
6
1/1 [==============================] - 0s 108ms/step
7
1/1 [==============================] - 0s 96ms/step
8
1/1 [==============================] - 0s 107ms/step
9
1/1 [==============================] - 0s 321ms/step
0
1/1 [==============================] - 0s 105ms/step
1
1/1 [==============================] - 0s 121ms/step
2
1/1 [==============================] - 0s 123ms/step
3
1/1 [==============================] - 0s 242ms/step
4
1/1 [==============================] - 0s 122ms/step
5
1/1 [==============================] - 0s 108ms/step
6
1/1 [==============================] - 0s 130ms/step
7
1/1 [==============================] - 0s 157ms/step
8
1/1 [==============================] - 0s 236ms/step
9
Epoch 1/100
172/172 [==============================] - 3s 9ms/step - loss: 1.3665
Epoch 2/100
172/172 [==============================] - 1s 7ms/step - loss: 0.3761
Epoch 3/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3724
Epoch 4/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3679
Epoch 5/100
172/172 [==============================] - 2s 10ms/step - loss: 0.3657
Epoch 6/100
172/172 [==============================] - 2s 9ms/step - loss: 0.3645
Epoch 7/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3635
Epoch 8/100
172/172 [==============================] - 2s 9ms/step - loss: 0.3625
Epoch 9/100
172/172 [==============================] - 2s 10ms/step - loss: 0.3603
Epoch 10/100
172/172 [==============================] - 2s 9ms/step - loss: 0.3599
Epoch 11/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3594
Epoch 12/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3566
Epoch 13/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3566
Epoch 14/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3556
Epoch 15/100
172/172 [==============================] - 1s 7ms/step - loss: 0.3561
Epoch 16/100
172/172 [==============================] - 2s 9ms/step - loss: 0.3565
Epoch 17/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3546
Epoch 18/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3547
Epoch 19/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3536
Epoch 20/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3546
Epoch 21/100
172/172 [==============================] - 1s 7ms/step - loss: 0.3527
Epoch 22/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3528
Epoch 23/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3522
Epoch 24/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3522
Epoch 25/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3538
Epoch 26/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3531
Epoch 27/100
172/172 [==============================] - 1s 9ms/step - loss: 0.3522
Epoch 28/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3515
Epoch 29/100
172/172 [==============================] - 2s 9ms/step - loss: 0.3509
Epoch 30/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3519
Epoch 31/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3512
Epoch 32/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3519
Epoch 33/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3503
Epoch 34/100
172/172 [==============================] - 1s 7ms/step - loss: 0.3509
Epoch 35/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3502
Epoch 36/100
172/172 [==============================] - 2s 12ms/step - loss: 0.3507
Epoch 37/100
172/172 [==============================] - 2s 12ms/step - loss: 0.3493
Epoch 38/100
172/172 [==============================] - 2s 11ms/step - loss: 0.3513
Epoch 39/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3492
Epoch 40/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3495
Epoch 41/100
172/172 [==============================] - 2s 10ms/step - loss: 0.3505
Epoch 42/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3487
Epoch 43/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3495
Epoch 44/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3509
Epoch 45/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3497
Epoch 46/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3508
Epoch 47/100
172/172 [==============================] - 1s 9ms/step - loss: 0.3485
Epoch 48/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3491
Epoch 49/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3487
Epoch 50/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3494
Epoch 51/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3487
Epoch 52/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3491
Epoch 53/100
172/172 [==============================] - 1s 9ms/step - loss: 0.3494
Epoch 54/100
172/172 [==============================] - 2s 9ms/step - loss: 0.3478
Epoch 55/100
172/172 [==============================] - 2s 10ms/step - loss: 0.3473
Epoch 56/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3488
Epoch 57/100
172/172 [==============================] - 1s 7ms/step - loss: 0.3490
Epoch 58/100
172/172 [==============================] - 1s 9ms/step - loss: 0.3480
Epoch 59/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3492
Epoch 60/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3484
Epoch 61/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3483
Epoch 62/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3490
Epoch 63/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3504
Epoch 64/100
172/172 [==============================] - 2s 9ms/step - loss: 0.3485
Epoch 65/100
172/172 [==============================] - 1s 8ms/step - loss: 0.3489
1/1 [==============================] - 0s 98ms/step
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span><span class="p">,</span> <span class="n">best_rmse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>({&#39;hidden_layer_sizes&#39;: (64, 64, 128), &#39;activation&#39;: &#39;relu&#39;},
 0.7258676282538975)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Finalmente el mejor modelo de los obtenidos es el SVR, probablemente el MLP podria haber obtenido un rendimiento superior si se hubiera probado con mas capas o otro configuración de la red, sin embargo aun asi obtiene uno cercano al 80%.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regresion_modelos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k-NN</td>
      <td>17.261516</td>
      <td>0.834286</td>
      <td>0.685043</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ridge</td>
      <td>17.924131</td>
      <td>0.665085</td>
      <td>0.799841</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lasso</td>
      <td>49.622335</td>
      <td>0.652041</td>
      <td>0.807615</td>
    </tr>
    <tr>
      <th>3</th>
      <td>XGBoost</td>
      <td>45.679888</td>
      <td>0.782845</td>
      <td>0.722685</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SVR</td>
      <td>50.894473</td>
      <td>0.602933</td>
      <td>0.835502</td>
    </tr>
    <tr>
      <th>6</th>
      <td>MLP</td>
      <td>15.770041</td>
      <td>0.682792</td>
      <td>0.789041</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Parcial Final ML</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#presentado-por-angel-pineda">Presentado por: Angel Pineda</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fraud-detection">Fraud Detection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lectura-de-dataset">Lectura de dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reduccion-de-dimensionalidad">Reduccion de dimensionalidad</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#eliminacion-de-columnas-numericas-altamente-correlacionadas">Eliminación de columnas numericas altamente correlacionadas.</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-dataset-reducido">Analisis de dataset reducido</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda-fraude-con-datos-reducidos">EDA FRAUDE CON DATOS REDUCIDOS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wind-speed">Wind Speed</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-bivariado">Analisis bivariado</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion">Modelo de Clasificacion</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nn">K-NN</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matriz-de-confusion-curva-roc">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logisticregression">LogisticRegression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-bayes">Naive Bayes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost">XGBoost</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svm">SVM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlp">MLP</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Matriz de Confusión, Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-del-modelo-de-clasificacion">Resultados del Modelo de clasificación</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-regresion">Modelo de regresion</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas">Metricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">K-NN</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge">Ridge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso">Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">XGBoost</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">MLP</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Angel Pineda
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>